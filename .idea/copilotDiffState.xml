<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Board/BoardService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Board/BoardService.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.Board;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.List;&#10;import java.util.Objects;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;@Transactional&#10;public class BoardService {&#10;&#10;    private final BoardRepository boardRepository;&#10;&#10;    // 제목은 20자 이하&#10;    public static boolean isTitleValid(String title) {&#10;        return title != null &amp;&amp; title.length() &lt;= 20;&#10;    }&#10;&#10;    // 내용은 200자 이하&#10;    public static boolean isContentValid(String content) {&#10;        return content != null &amp;&amp; content.length() &lt;= 200;&#10;    }&#10;&#10;    // 시작 시간이 종료 시간 이후면 경고 메시지 반환, 아니면 null&#10;    public static String validateMeetingTime(java.time.LocalDateTime start, java.time.LocalDateTime end) {&#10;        if (start != null &amp;&amp; end != null &amp;&amp; start.isAfter(end)) {&#10;            return &quot;시작 시간이 종료 시간보다 빠를 수 없습니다.&quot;;&#10;        }&#10;        return null;&#10;    }&#10;&#10;    // 제한 인원이 1 미만이면 경고 메시지 반환, 아니면 null&#10;    public static String validateLimitCount(Integer limitCount) {&#10;        if (limitCount == null || limitCount &lt; 1) {&#10;            return &quot;최소 1명 이상이어야 합니다&quot;;&#10;        }&#10;        return null;&#10;    }&#10;&#10;    public List&lt;Board&gt; findAll() {&#10;        return boardRepository.findAll();&#10;    }&#10;&#10;    public Board findById(Long id) {&#10;        return boardRepository.findById(id)&#10;                .orElseThrow(() -&gt; new IllegalArgumentException(&quot;게시글을 찾을 수 없습니다: &quot; + id));&#10;    }&#10;&#10;    public Board save(Board board) {&#10;        Objects.requireNonNull(board, &quot;게시글 정보가 null 입니다&quot;);&#10;        if (!isTitleValid(board.getTitle())) {&#10;            throw new IllegalArgumentException(&quot;제목 길이 20자를 초과할 수 없습니다&quot;);&#10;        }&#10;        if (!isContentValid(board.getContent())) {&#10;            throw new IllegalArgumentException(&quot;내용 길이 200자를 초과할 수 없습니다&quot;);&#10;        }&#10;        String timeMsg = validateMeetingTime(board.getMeetingStartTime(), board.getMeetingEndTime());&#10;        if (timeMsg != null) {&#10;            throw new IllegalArgumentException(timeMsg);&#10;        }&#10;        String countMsg = validateLimitCount(board.getLimitCount());&#10;        if (countMsg != null) {&#10;            throw new IllegalArgumentException(countMsg);&#10;        }&#10;        return boardRepository.save(board);&#10;    }&#10;&#10;    public void delete(Long id) {&#10;        boardRepository.deleteById(id);&#10;    }&#10;&#10;    public List&lt;Board&gt; searchBoards(String keyword) {&#10;        if (keyword == null || keyword.trim().isEmpty()) {&#10;            return boardRepository.findAll();&#10;        }&#10;        return boardRepository.findByTitleContainingOrContentContaining(keyword, keyword);&#10;    }&#10;&#10;    //전체 게시글을 생성일 기준 내림차순으로 정렬해서 반환&#10;    @Transactional(readOnly = true)&#10;    public List&lt;Board&gt; getAllSorted() {&#10;        return boardRepository.findAllByOrderByCreatedAtDesc();&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.Board;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.List;&#10;import java.util.Objects;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;@Transactional&#10;public class BoardService {&#10;&#10;    private final BoardRepository boardRepository;&#10;&#10;    // 제목은 20자 이하&#10;    public static boolean isTitleValid(String title) {&#10;        return title != null &amp;&amp; title.length() &lt;= 20;&#10;    }&#10;&#10;    // 내용은 200자 이하&#10;    public static boolean isContentValid(String content) {&#10;        return content != null &amp;&amp; content.length() &lt;= 200;&#10;    }&#10;&#10;    // 시작 시간이 종료 시간 이후면 경고 메시지 반환, 아니면 null&#10;    public static String validateMeetingTime(java.time.LocalDateTime start, java.time.LocalDateTime end) {&#10;        if (start != null &amp;&amp; end != null &amp;&amp; start.isAfter(end)) {&#10;            return &quot;시작 시간이 종료 시간보다 빠를 수 없습니다.&quot;;&#10;        }&#10;        return null;&#10;    }&#10;&#10;    // 제한 인원이 1 미만이면 경고 메시지 반환, 아니면 null&#10;    public static String validateLimitCount(Integer limitCount) {&#10;        if (limitCount == null || limitCount &lt; 1) {&#10;            return &quot;최소 1명 이상이어야 합니다&quot;;&#10;        }&#10;        return null;&#10;    }&#10;&#10;    public List&lt;Board&gt; findAll() {&#10;        return boardRepository.findAllWithUserFetchJoinOrderByCreatedAtDesc();&#10;    }&#10;&#10;    public Board findById(Long id) {&#10;        return boardRepository.findById(id)&#10;                .orElseThrow(() -&gt; new IllegalArgumentException(&quot;게시글을 찾을 수 없습니다: &quot; + id));&#10;    }&#10;&#10;    public Board save(Board board) {&#10;        Objects.requireNonNull(board, &quot;게시글 정보가 null 입니다&quot;);&#10;        if (!isTitleValid(board.getTitle())) {&#10;            throw new IllegalArgumentException(&quot;제목 길이 20자를 초과할 수 없습니다&quot;);&#10;        }&#10;        if (!isContentValid(board.getContent())) {&#10;            throw new IllegalArgumentException(&quot;내용 길이 200자를 초과할 수 없습니다&quot;);&#10;        }&#10;        String timeMsg = validateMeetingTime(board.getMeetingStartTime(), board.getMeetingEndTime());&#10;        if (timeMsg != null) {&#10;            throw new IllegalArgumentException(timeMsg);&#10;        }&#10;        String countMsg = validateLimitCount(board.getLimitCount());&#10;        if (countMsg != null) {&#10;            throw new IllegalArgumentException(countMsg);&#10;        }&#10;        return boardRepository.save(board);&#10;    }&#10;&#10;    public void delete(Long id) {&#10;        boardRepository.deleteById(id);&#10;    }&#10;&#10;    public List&lt;Board&gt; searchBoards(String keyword) {&#10;        if (keyword == null || keyword.trim().isEmpty()) {&#10;            return boardRepository.findAllWithUserFetchJoinOrderByCreatedAtDesc();&#10;        }&#10;        return boardRepository.findByKeywordWithUserFetchJoin(keyword);&#10;    }&#10;&#10;    //전체 게시글을 생성일 기준 내림차순으로 정렬해서 반환&#10;    @Transactional(readOnly = true)&#10;    public List&lt;Board&gt; getAllSorted() {&#10;        return boardRepository.findAllWithUserFetchJoinOrderByCreatedAtDesc();&#10;    }&#10;&#10;    // 카테고리별 목록 페치 조인&#10;    @Transactional(readOnly = true)&#10;    public List&lt;Board&gt; getByCategorySorted(String category) {&#10;        return boardRepository.findByCategoryWithUserFetchJoinOrderByCreatedAtDesc(category);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Comment/CommentController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Comment/CommentController.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.Comment;&#10;&#10;import com.SYUcap.SYUcap.User.CustomUser;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.core.Authentication;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;import java.net.URLEncoder;&#10;import java.nio.charset.StandardCharsets;&#10;&#10;@Controller&#10;@RequiredArgsConstructor&#10;@RequestMapping(&quot;/board&quot;)&#10;public class CommentController {&#10;&#10;    private final CommentService commentService;&#10;&#10;    @PostMapping(&quot;/{cat}/{id}/comment&quot;)&#10;    public String addComment(@PathVariable(&quot;cat&quot;) String category,&#10;                             @PathVariable(&quot;id&quot;) Long boardId,&#10;                             @RequestParam(&quot;content&quot;) String content,&#10;                             Authentication auth) {&#10;        String authorName = &quot;익명&quot;;&#10;        if (auth != null &amp;&amp; auth.getPrincipal() instanceof CustomUser cu) {&#10;            authorName = cu.getUserName();&#10;        }&#10;        commentService.createComment(boardId, content, authorName);&#10;        String encodedCat = URLEncoder.encode(category, StandardCharsets.UTF_8);&#10;        return &quot;redirect:/board/&quot; + encodedCat + &quot;/&quot; + boardId;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.Comment;&#10;&#10;import com.SYUcap.SYUcap.User.CustomUser;&#10;import com.SYUcap.SYUcap.User.Users;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.core.Authentication;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;import java.net.URLEncoder;&#10;import java.nio.charset.StandardCharsets;&#10;&#10;@Controller&#10;@RequiredArgsConstructor&#10;@RequestMapping(&quot;/board&quot;)&#10;public class CommentController {&#10;&#10;    private final CommentService commentService;&#10;&#10;    @PostMapping(&quot;/{cat}/{id}/comment&quot;)&#10;    public String addComment(@PathVariable(&quot;cat&quot;) String category,&#10;                             @PathVariable(&quot;id&quot;) Long boardId,&#10;                             @RequestParam(&quot;content&quot;) String content,&#10;                             Authentication auth) {&#10;        String authorName = &quot;익명&quot;;&#10;        Users loginUser = null;&#10;        if (auth != null &amp;&amp; auth.getPrincipal() instanceof CustomUser cu) {&#10;            authorName = cu.getUserName();&#10;            loginUser = new Users();&#10;            loginUser.setId(cu.getId());&#10;            loginUser.setUserName(cu.getUserName());&#10;            // 주어진 정보로 Users 프록시 객체를 구성 (필요 최소 필드)&#10;        }&#10;        commentService.createComment(boardId, content, authorName, loginUser);&#10;        String encodedCat = URLEncoder.encode(category, StandardCharsets.UTF_8);&#10;        return &quot;redirect:/board/&quot; + encodedCat + &quot;/&quot; + boardId;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Comment/CommentService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Comment/CommentService.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.Comment;&#10;&#10;import com.SYUcap.SYUcap.Board.Board;&#10;import com.SYUcap.SYUcap.Board.BoardRepository;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.dao.DataIntegrityViolationException;&#10;import org.springframework.stereotype.Service;&#10;import java.util.List;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class CommentService {&#10;&#10;    private final CommentRepository commentRepository;&#10;    private final BoardRepository boardRepository; // BoardService가 아닌 Repository가 필요합니다.&#10;&#10;    public void createComment(Long boardId, String content, String authorName) {&#10;        // 유효성: boardId null 금지&#10;        if (boardId == null) {&#10;            throw new IllegalArgumentException(&quot;boardId가 null입니다&quot;);&#10;        }&#10;        // 유효성: content null 금지(정책상 DB 제약 위반으로 간주)&#10;        if (content == null) {&#10;            throw new DataIntegrityViolationException(&quot;content가 null입니다&quot;);&#10;        }&#10;        // 유효성: authorName null 금지(정책상 DB 제약 위반으로 간주)&#10;        if (authorName == null) {&#10;            throw new DataIntegrityViolationException(&quot;authorName이 null입니다&quot;);&#10;        }&#10;&#10;        Board board = boardRepository.findById(boardId)&#10;                .orElseThrow(() -&gt; new IllegalArgumentException(&quot;해당 게시글이 없습니다. id=&quot; + boardId));&#10;&#10;        Comment comment = new Comment();&#10;        comment.setContent(content);&#10;        comment.setAuthorName(authorName);&#10;        comment.setBoard(board); // 조회한 Board 엔티티를 Comment에 연결&#10;&#10;        commentRepository.save(comment);&#10;    }&#10;&#10;&#10;    public List&lt;Comment&gt; getCommentsByBoardId(Long boardId) {&#10;        return commentRepository.findByBoardId(boardId);&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.Comment;&#10;&#10;import com.SYUcap.SYUcap.Board.Board;&#10;import com.SYUcap.SYUcap.Board.BoardRepository;&#10;import com.SYUcap.SYUcap.User.Users;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.dao.DataIntegrityViolationException;&#10;import org.springframework.stereotype.Service;&#10;import java.util.List;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class CommentService {&#10;&#10;    private final CommentRepository commentRepository;&#10;    private final BoardRepository boardRepository;&#10;&#10;    /**&#10;     * 댓글 생성 (로그인 유저 연동)&#10;     */&#10;    public void createComment(Long boardId, String content, String authorName, Users user) {&#10;        // 유효성: boardId null 금지&#10;        if (boardId == null) {&#10;            throw new IllegalArgumentException(&quot;boardId가 null입니다&quot;);&#10;        }&#10;        // 유효성: content null 금지(정책상 DB 제약 위반으로 간주)&#10;        if (content == null) {&#10;            throw new DataIntegrityViolationException(&quot;content가 null입니다&quot;);&#10;        }&#10;        // 유효성: authorName, user null 금지(둘 다 없으면 누가 작성했는지 알 수 없음)&#10;        if (authorName == null &amp;&amp; user == null) {&#10;            throw new DataIntegrityViolationException(&quot;author 정보가 없습니다&quot;);&#10;        }&#10;&#10;        Board board = boardRepository.findById(boardId)&#10;                .orElseThrow(() -&gt; new IllegalArgumentException(&quot;해당 게시글이 없습니다. id=&quot; + boardId));&#10;&#10;        Comment comment = new Comment();&#10;        comment.setContent(content);&#10;        // authorName은 표시용, 로그인 유저가 있으면 우선 사용&#10;        if (user != null &amp;&amp; user.getUserName() != null) {&#10;            comment.setAuthorName(user.getUserName());&#10;        } else {&#10;            comment.setAuthorName(authorName);&#10;        }&#10;        comment.setBoard(board);&#10;        comment.setUser(user); // 댓글 작성자 정보 설정&#10;&#10;        commentRepository.save(comment);&#10;    }&#10;&#10;&#10;    public List&lt;Comment&gt; getCommentsByBoardId(Long boardId) {&#10;        return commentRepository.findByBoardId(boardId);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Mypage/MypageController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/Mypage/MypageController.java" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.Mypage;&#10;&#10;import com.SYUcap.SYUcap.User.UserService;&#10;import com.SYUcap.SYUcap.User.Users;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.core.annotation.AuthenticationPrincipal;&#10;import org.springframework.security.core.userdetails.UserDetails;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.ui.Model;&#10;import org.springframework.web.bind.annotation.GetMapping;&#10;import org.springframework.web.bind.annotation.ModelAttribute;&#10;import org.springframework.web.bind.annotation.PostMapping;&#10;&#10;@Controller&#10;@RequiredArgsConstructor&#10;public class MypageController {&#10;&#10;    private final UserService userService;&#10;&#10;    /** 마이페이지 메인 (조회) */&#10;    @GetMapping(&quot;/mypage&quot;)&#10;    public String mypage(@AuthenticationPrincipal UserDetails userDetails, Model model) {&#10;        Users me = userService.getCurrentUser(userDetails);&#10;        model.addAttribute(&quot;user&quot;, me);&#10;        return &quot;mypage&quot;;&#10;    }&#10;&#10;    /** 마이페이지 수정 폼 */&#10;    @GetMapping(&quot;/mypage/edit&quot;)&#10;    public String mypageEdit(@AuthenticationPrincipal UserDetails userDetails, Model model) {&#10;        Users me = userService.getCurrentUser(userDetails);&#10;        model.addAttribute(&quot;user&quot;, me);&#10;        return &quot;mypage-edit&quot;;&#10;    }&#10;&#10;    /** 마이페이지 수정 처리 */&#10;    @PostMapping(&quot;/mypage/edit&quot;)&#10;    public String updateMyInfo(@AuthenticationPrincipal UserDetails userDetails,&#10;                               @ModelAttribute(&quot;userName&quot;) String userName,&#10;                               @ModelAttribute(value = &quot;password&quot;, required = false) String password,&#10;                               @ModelAttribute(value = &quot;passwordConfirm&quot;, required = false) String passwordConfirm) {&#10;        userService.updateMyInfo(userDetails, userName, password, passwordConfirm);&#10;        return &quot;redirect:/mypage&quot;;&#10;    }&#10;&#10;    /** 계정 삭제 */&#10;    @PostMapping(&quot;/mypage/delete&quot;)&#10;    public String deleteMyAccount(@AuthenticationPrincipal UserDetails userDetails) {&#10;        userService.deleteMyAccount(userDetails);&#10;        return &quot;redirect:/home&quot;;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/MypageController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/MypageController.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.core.annotation.AuthenticationPrincipal;&#10;import org.springframework.security.core.userdetails.UserDetails;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.ui.Model;&#10;import org.springframework.web.bind.annotation.DeleteMapping;&#10;import org.springframework.web.bind.annotation.GetMapping;&#10;import org.springframework.web.bind.annotation.RequestParam;&#10;import org.springframework.web.bind.annotation.PathVariable;&#10;import org.springframework.web.bind.annotation.PostMapping;&#10;&#10;@Controller&#10;@RequiredArgsConstructor&#10;public class MypageController {&#10;&#10;    private final UserService userService;&#10;&#10;    /** 마이페이지 메인 (조회) - 로그인 유저 기준 */&#10;    @GetMapping(&quot;/mypage&quot;)&#10;    public String mypage(@AuthenticationPrincipal UserDetails userDetails, Model model) {&#10;        Users me = userService.getCurrentUser(userDetails);&#10;        model.addAttribute(&quot;user&quot;, me);&#10;        return &quot;mypage&quot;;&#10;    }&#10;&#10;    /** 마이페이지 수정 폼 - 로그인 유저 기준 */&#10;    @GetMapping(&quot;/mypage/edit&quot;)&#10;    public String mypageEdit(@AuthenticationPrincipal UserDetails userDetails, Model model) {&#10;        Users me = userService.getCurrentUser(userDetails);&#10;        model.addAttribute(&quot;user&quot;, me);&#10;        return &quot;mypage-edit&quot;;&#10;    }&#10;&#10;    /** 마이페이지 수정 처리 -  POST 사용 */&#10;    @PostMapping(&quot;/mypage/edit&quot;)&#10;    public String updateMyInfo(@AuthenticationPrincipal UserDetails userDetails,&#10;                               @RequestParam(&quot;userName&quot;) String userName,&#10;                               @RequestParam(value = &quot;password&quot;, required = false) String password,&#10;                               @RequestParam(value = &quot;passwordConfirm&quot;, required = false) String passwordConfirm,&#10;                               @RequestParam(value = &quot;newUserId&quot;, required = false) String newUserId) {&#10;        userService.updateMyInfo(userDetails, userName, password, passwordConfirm, newUserId);&#10;        return &quot;redirect:/mypage&quot;;&#10;    }&#10;&#10;    /** 계정 삭제 - 게시판 삭제처럼 DELETE 메서드 사용 (REST 스타일) */&#10;    @DeleteMapping(&quot;/mypage/{id}&quot;)&#10;    public String deleteMyAccount(@AuthenticationPrincipal UserDetails userDetails,&#10;                                  @PathVariable Long id) {&#10;        // id는 URL 형식 통일을 위한 것으로, 실제 삭제는 로그인 유저 기준으로 처리&#10;        userService.deleteMyAccount(userDetails);&#10;        return &quot;redirect:/home&quot;;&#10;    }&#10;    // 로그아웃 기능&#10;    @GetMapping(&quot;/logout&quot;)&#10;    public String logout() {&#10;        return &quot;redirect:/mypage&quot;;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.core.annotation.AuthenticationPrincipal;&#10;import org.springframework.security.core.userdetails.UserDetails;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.ui.Model;&#10;import org.springframework.web.bind.annotation.DeleteMapping;&#10;import org.springframework.web.bind.annotation.GetMapping;&#10;import org.springframework.web.bind.annotation.RequestParam;&#10;import org.springframework.web.bind.annotation.PathVariable;&#10;import org.springframework.web.bind.annotation.PostMapping;&#10;&#10;@Controller&#10;@RequiredArgsConstructor&#10;public class MypageController {&#10;&#10;    private final UserService userService;&#10;&#10;    /** 마이페이지 메인 (조회) - 로그인 유저 기준 */&#10;    @GetMapping(&quot;/mypage&quot;)&#10;    public String mypage(@AuthenticationPrincipal UserDetails userDetails, Model model) {&#10;        Users me = userService.getCurrentUser(userDetails);&#10;        model.addAttribute(&quot;user&quot;, me);&#10;        return &quot;mypage&quot;;&#10;    }&#10;&#10;    /** 마이페이지 수정 폼 - 로그인 유저 기준 */&#10;    @GetMapping(&quot;/mypage/edit&quot;)&#10;    public String mypageEdit(@AuthenticationPrincipal UserDetails userDetails, Model model) {&#10;        Users me = userService.getCurrentUser(userDetails);&#10;        model.addAttribute(&quot;user&quot;, me);&#10;        return &quot;mypage-edit&quot;;&#10;    }&#10;&#10;    /** 마이페이지 수정 처리 -  POST 사용 */&#10;    @PostMapping(&quot;/mypage/edit&quot;)&#10;    public String updateMyInfo(@AuthenticationPrincipal UserDetails userDetails,&#10;                               @RequestParam(&quot;userName&quot;) String userName,&#10;                               @RequestParam(value = &quot;password&quot;, required = false) String password,&#10;                               @RequestParam(value = &quot;passwordConfirm&quot;, required = false) String passwordConfirm,&#10;                               @RequestParam(value = &quot;newUserId&quot;, required = false) String newUserId) {&#10;        userService.updateMyInfo(userDetails, userName, password, passwordConfirm, newUserId);&#10;        return &quot;redirect:/mypage&quot;;&#10;    }&#10;&#10;    /** 계정 삭제 - 게시판 삭제처럼 DELETE 메서드 사용 (REST 스타일) */&#10;    @DeleteMapping(&quot;/mypage/{id}&quot;)&#10;    public String deleteMyAccount(@AuthenticationPrincipal UserDetails userDetails,&#10;                                  @PathVariable Long id) {&#10;        // id는 URL 형식 통일을 위한 것으로, 실제 삭제는 로그인 유저 기준으로 처리&#10;        userService.deleteMyAccount(userDetails);&#10;        return &quot;redirect:/home&quot;;&#10;    }&#10;&#10;    /** 로그아웃 기능: 스프링 시큐리티 로그아웃 URL과 연동 */&#10;    @PostMapping(&quot;/logout&quot;)&#10;    public String logout() {&#10;        // SecurityConfig에서 logoutSuccessUrl(&quot;/home&quot;) 설정과 맞춰 홈으로 이동&#10;        return &quot;redirect:/home&quot;;&#10;    }&#10;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/SecurityConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/SecurityConfig.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.security.config.annotation.web.builders.HttpSecurity;&#10;import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;&#10;import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;&#10;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.security.web.SecurityFilterChain;&#10;&#10;@Configuration&#10;@EnableWebSecurity&#10;public class SecurityConfig {&#10;    @Bean&#10;    PasswordEncoder passwordEncoder() {&#10;        return new BCryptPasswordEncoder();&#10;    }&#10;&#10;    @Bean&#10;    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {&#10;        http.csrf(AbstractHttpConfigurer::disable);&#10;&#10;        http.authorizeHttpRequests(authorize -&gt; authorize&#10;                // 로그인/회원가입, 정적 리소스, 홈 등은 모두 허용&#10;                .requestMatchers(&quot;/&quot;, &quot;/home&quot;, &quot;/login&quot;, &quot;/signup&quot;, &quot;/css/**&quot;, &quot;/js/**&quot;, &quot;/images/**&quot;).permitAll()&#10;                // 게시판과 마이페이지는 인증 필요&#10;                .requestMatchers(&quot;/board/**&quot;, &quot;/mypage&quot;, &quot;/mypage/**&quot;).authenticated()&#10;                .anyRequest().permitAll()&#10;        );&#10;&#10;        http.formLogin(formLogin -&gt; formLogin&#10;                .loginPage(&quot;/login&quot;)&#10;                .loginProcessingUrl(&quot;/login&quot;)&#10;                .defaultSuccessUrl(&quot;/home&quot;, true)&#10;                .failureUrl(&quot;/login?error&quot;)&#10;                .usernameParameter(&quot;userId&quot;)&#10;                .passwordParameter(&quot;password&quot;)&#10;                .permitAll()&#10;        );&#10;&#10;        http.logout(logout -&gt; logout&#10;                .logoutUrl(&quot;/logout&quot;)&#10;                .logoutSuccessUrl(&quot;/home&quot;)&#10;        );&#10;&#10;        return http.build();&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.security.config.annotation.web.builders.HttpSecurity;&#10;import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;&#10;import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;&#10;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.security.web.SecurityFilterChain;&#10;&#10;@Configuration&#10;@EnableWebSecurity&#10;public class SecurityConfig {&#10;    @Bean&#10;    PasswordEncoder passwordEncoder() {&#10;        return new BCryptPasswordEncoder();&#10;    }&#10;&#10;    @Bean&#10;    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {&#10;        // CSRF: 마이페이지는 테스트 편의상 토큰 검사는 생략하지만,&#10;        // 인가 규칙에서 여전히 인증(authentication)은 필수로 둔다.&#10;        http.csrf(csrf -&gt; csrf&#10;                .ignoringRequestMatchers(&quot;/mypage/**&quot;)&#10;        );&#10;&#10;        http.authorizeHttpRequests(authorize -&gt; authorize&#10;                // 로그인/회원가입, 정적 리소스, 홈 등은 모두 허용&#10;                .requestMatchers(&quot;/&quot;, &quot;/home&quot;, &quot;/login&quot;, &quot;/signup&quot;, &quot;/css/**&quot;, &quot;/js/**&quot;, &quot;/images/**&quot;).permitAll()&#10;                // 게시판과 마이페이지는 반드시 로그인한 사용자만 접근 가능&#10;                .requestMatchers(&quot;/board/**&quot;, &quot;/mypage&quot;, &quot;/mypage/**&quot;).authenticated()&#10;                .anyRequest().permitAll()&#10;        );&#10;&#10;        http.formLogin(formLogin -&gt; formLogin&#10;                .loginPage(&quot;/login&quot;)&#10;                .loginProcessingUrl(&quot;/login&quot;)&#10;                .defaultSuccessUrl(&quot;/home&quot;, true)&#10;                .failureUrl(&quot;/login?error&quot;)&#10;                .usernameParameter(&quot;userId&quot;)&#10;                .passwordParameter(&quot;password&quot;)&#10;                .permitAll()&#10;        );&#10;&#10;        http.logout(logout -&gt; logout&#10;                .logoutUrl(&quot;/logout&quot;)&#10;                .logoutSuccessUrl(&quot;/home&quot;)&#10;        );&#10;&#10;        http.httpBasic();&#10;&#10;        return http.build();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/UserController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/UserController.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.ui.Model;&#10;import org.springframework.web.bind.annotation.GetMapping;&#10;import org.springframework.web.bind.annotation.PostMapping;&#10;import org.springframework.web.bind.annotation.RequestParam;&#10;&#10;@Controller&#10;@RequiredArgsConstructor&#10;public class UserController {&#10;    private final UserService userService;&#10;    private final UserRepository userRepository;&#10;&#10;    /** 회원가입 폼 */&#10;    @GetMapping(&quot;/signup&quot;)&#10;    String signup() {&#10;        return &quot;signup.html&quot;;&#10;    }&#10;&#10;    @GetMapping(&quot;/login&quot;)&#10;    String login(@RequestParam(value = &quot;error&quot;, required = false) String error, Model model) {&#10;        if (error != null) {&#10;            model.addAttribute(&quot;error&quot;, true);&#10;        }&#10;        return &quot;login&quot;;&#10;    }&#10;    /** 회원가입 */&#10;    @PostMapping(&quot;/signup&quot;)&#10;    String addUser(@RequestParam String userId,&#10;                   @RequestParam String password,&#10;                   @RequestParam String passwordConfirm,&#10;                   @RequestParam String userName ) {&#10;        userService.addUser(userId, password, passwordConfirm, userName);&#10;        return &quot;login.html&quot;;&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.stereotype.Controller;&#10;import org.springframework.ui.Model;&#10;import org.springframework.web.bind.annotation.GetMapping;&#10;import org.springframework.web.bind.annotation.PostMapping;&#10;import org.springframework.web.bind.annotation.RequestParam;&#10;&#10;@Controller&#10;@RequiredArgsConstructor&#10;public class UserController {&#10;    private final UserService userService;&#10;    private final UserRepository userRepository;&#10;&#10;    /** 회원가입 폼 */&#10;    @GetMapping(&quot;/signup&quot;)&#10;    String signup() {&#10;        return &quot;signup.html&quot;;&#10;    }&#10;&#10;    @GetMapping(&quot;/login&quot;)&#10;    String login(@RequestParam(value = &quot;error&quot;, required = false) String error, Model model) {&#10;        if (error != null) {&#10;            model.addAttribute(&quot;error&quot;, true);&#10;        }&#10;        return &quot;login&quot;;&#10;    }&#10;    /** 회원가입 */&#10;    @PostMapping(&quot;/signup&quot;)&#10;    String addUser(@RequestParam String userId,&#10;                   @RequestParam String password,&#10;                   @RequestParam String passwordConfirm,&#10;                   @RequestParam String userName ) {&#10;        userService.addUser(userId, password, passwordConfirm, userName);&#10;        return &quot;login.html&quot;;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/UserService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/java/com/SYUcap/SYUcap/User/UserService.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.core.userdetails.UserDetails;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class UserService {&#10;    private final UserRepository userRepository;&#10;    private final PasswordEncoder passwordEncoder;&#10;&#10;    public void addUser(String userId, String password, String passwordConfirm,String username) {&#10;        // 아이디 공백 검사&#10;        if (userId != null &amp;&amp; userId.contains(&quot; &quot;)) {&#10;            throw new IllegalArgumentException(&quot;아이디에 공백이 포함될 수 없습니다.&quot;);&#10;        }&#10;&#10;        // 제어문자 검사 (아이디)&#10;        if (containsControlChar(userId)) {&#10;            throw new IllegalArgumentException(&quot;아이디에 제어 문자가 포함될 수 없습니다.&quot;);&#10;        }&#10;&#10;        // 제어문자 검사 (비밀번호)&#10;        if (containsControlChar(password)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호에 제어 문자가 포함될 수 없습니다.&quot;);&#10;        }&#10;&#10;        // 아이디 중복 검사&#10;        if (userRepository.findByUserId(userId).isPresent()) {&#10;            throw new IllegalArgumentException(&quot;이미 존재하는 아이디입니다.&quot;);&#10;        }&#10;        // 비밀번호 유효성 검사: 6~16자, 특수문자 1개 이상&#10;        if (!isValidPasswordlength(password)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호는 6~16자이어야 합니다&quot;);&#10;        }&#10;        if(!password.equals(passwordConfirm)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호와 비밀번호 확인이 일치하지 않습니다.&quot;);&#10;        }&#10;        if (!containsSpecialCh(password)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호에 특수문자가 포함되어야 합니다.&quot;);&#10;        }&#10;        Users user = new Users();&#10;        var hash = passwordEncoder.encode(password);&#10;        user.setUserId(userId);&#10;        user.setPassword(hash);&#10;        user.setUserName(username);&#10;        userRepository.save(user);&#10;    }&#10;&#10;    /** 현재 로그인 유저 조회 (마이페이지용) */&#10;    @Transactional(readOnly = true)&#10;    public Users getCurrentUser(UserDetails userDetails) {&#10;        if (userDetails == null) {&#10;            throw new IllegalStateException(&quot;로그인 사용자가 없습니다.&quot;);&#10;        }&#10;        String loginId = userDetails.getUsername();&#10;        return userRepository.findByUserId(loginId)&#10;                .orElseThrow(() -&gt; new IllegalArgumentException(&quot;사용자를 찾을 수 없습니다.&quot;));&#10;    }&#10;&#10;    /** 마이페이지 정보 수정 */&#10;    @Transactional&#10;    public void updateMyInfo(UserDetails userDetails, String userName, String password, String passwordConfirm) {&#10;        Users me = getCurrentUser(userDetails);&#10;&#10;        // 이름 변경&#10;        if (userName != null &amp;&amp; !userName.isBlank()) {&#10;            me.setUserName(userName);&#10;        }&#10;&#10;        // 비밀번호 변경 (둘 다 입력된 경우에만)&#10;        if (password != null &amp;&amp; !password.isBlank()) {&#10;            if (!password.equals(passwordConfirm)) {&#10;                throw new IllegalArgumentException(&quot;비밀번호와 비밀번호 확인이 일치하지 않습니다.&quot;);&#10;            }&#10;            if (!isValidPasswordlength(password) || !containsSpecialCh(password)) {&#10;                throw new IllegalArgumentException(&quot;비밀번호 정책을 확인해주세요.&quot;);&#10;            }&#10;            me.setPassword(passwordEncoder.encode(password));&#10;        }&#10;        // 변경 내용은 트랜잭션 종료 시점에 자동 flush&#10;    }&#10;&#10;    /** 계정 삭제 */&#10;    @Transactional&#10;    public void deleteMyAccount(UserDetails userDetails) {&#10;        Users me = getCurrentUser(userDetails);&#10;        userRepository.delete(me);&#10;    }&#10;&#10;    private boolean isValidPasswordlength(String password) {&#10;        if (password == null) return false;&#10;        int len = password.length();&#10;        if (len &lt; 6 || len &gt; 16) return false;&#10;        return true;&#10;    }&#10;    private boolean containsSpecialCh(String password){&#10;        String specialChars = &quot;!@#$%^&amp;*()-_=+[]{}|;:'\&quot;,.&lt;&gt;?/`~&quot;;&#10;        for (char c : password.toCharArray()) {&#10;            if (specialChars.indexOf(c) != -1) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;&#10;    // 제어문자(\n, \t, \r 등) 포함 여부 검사&#10;    private boolean containsControlChar(String input) {&#10;        if (input == null) return false;&#10;        for (char c : input.toCharArray()) {&#10;            if (Character.isISOControl(c)) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.core.userdetails.UserDetails;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class UserService {&#10;    private final UserRepository userRepository;&#10;    private final PasswordEncoder passwordEncoder;&#10;&#10;    public void addUser(String userId, String password, String passwordConfirm,String username) {&#10;        // 아이디 공백 검사&#10;        if (userId != null &amp;&amp; userId.contains(&quot; &quot;)) {&#10;            throw new IllegalArgumentException(&quot;아이디에 공백이 포함될 수 없습니다.&quot;);&#10;        }&#10;&#10;        // 제어문자 검사 (아이디)&#10;        if (containsControlChar(userId)) {&#10;            throw new IllegalArgumentException(&quot;아이디에 제어 문자가 포함될 수 없습니다.&quot;);&#10;        }&#10;&#10;        // 제어문자 검사 (비밀번호)&#10;        if (containsControlChar(password)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호에 제어 문자가 포함될 수 없습니다.&quot;);&#10;        }&#10;&#10;        // 아이디 중복 검사&#10;        if (userRepository.findByUserId(userId).isPresent()) {&#10;            throw new IllegalArgumentException(&quot;이미 존재하는 아이디입니다.&quot;);&#10;        }&#10;        // 비밀번호 유효성 검사: 6~16자, 특수문자 1개 이상&#10;        if (!isValidPasswordlength(password)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호는 6~16자이어야 합니다&quot;);&#10;        }&#10;        if(!password.equals(passwordConfirm)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호와 비밀번호 확인이 일치하지 않습니다.&quot;);&#10;        }&#10;        if (!containsSpecialCh(password)) {&#10;            throw new IllegalArgumentException(&quot;비밀번호에 특수문자가 포함되어야 합니다.&quot;);&#10;        }&#10;        Users user = new Users();&#10;        var hash = passwordEncoder.encode(password);&#10;        user.setUserId(userId);&#10;        user.setPassword(hash);&#10;        user.setUserName(username);&#10;        userRepository.save(user);&#10;    }&#10;&#10;    /** 현재 로그인 유저 조회 (마이페이지용) */&#10;    @Transactional(readOnly = true)&#10;    public Users getCurrentUser(UserDetails userDetails) {&#10;        if (userDetails == null) {&#10;            throw new IllegalStateException(&quot;로그인 사용자가 없습니다.&quot;);&#10;        }&#10;        String loginId = userDetails.getUsername();&#10;        return userRepository.findByUserId(loginId)&#10;                .orElseThrow(() -&gt; new IllegalArgumentException(&quot;사용자를 찾을 수 없습니다.&quot;));&#10;    }&#10;&#10;    /** 마이페이지 정보 수정 (이름, 비밀번호, 아이디 변경) */&#10;    @Transactional&#10;    public void updateMyInfo(UserDetails userDetails, String userName,&#10;                             String password, String passwordConfirm,&#10;                             String newUserId) {&#10;        Users me = getCurrentUser(userDetails);&#10;&#10;        // 아이디 변경: 값이 있고, 기존 아이디와 다를 때만 처리&#10;        if (newUserId != null &amp;&amp; !newUserId.isBlank() &amp;&amp; !newUserId.equals(me.getUserId())) {&#10;            // 공백 금지&#10;            if (newUserId.contains(&quot; &quot;)) {&#10;                throw new IllegalArgumentException(&quot;아이디에 공백이 포함될 수 없습니다.&quot;);&#10;            }&#10;            // 제어문자 금지&#10;            if (containsControlChar(newUserId)) {&#10;                throw new IllegalArgumentException(&quot;아이디에 제어 문자가 포함될 수 없습니다.&quot;);&#10;            }&#10;            // 중복 검사&#10;            if (userRepository.findByUserId(newUserId).isPresent()) {&#10;                throw new IllegalArgumentException(&quot;이미 존재하는 아이디입니다.&quot;);&#10;            }&#10;            me.setUserId(newUserId);&#10;        }&#10;&#10;        // 이름 변경&#10;        if (userName != null &amp;&amp; !userName.isBlank()) {&#10;            me.setUserName(userName);&#10;        }&#10;&#10;        // 비밀번호 변경 (둘 다 입력된 경우에만)&#10;        if (password != null &amp;&amp; !password.isBlank()) {&#10;            if (!password.equals(passwordConfirm)) {&#10;                throw new IllegalArgumentException(&quot;비밀번호와 비밀번호 확인이 일치하지 않습니다.&quot;);&#10;            }&#10;            if (!isValidPasswordlength(password) || !containsSpecialCh(password)) {&#10;                throw new IllegalArgumentException(&quot;비밀번호 정책을 확인해주세요.&quot;);&#10;            }&#10;            me.setPassword(passwordEncoder.encode(password));&#10;        }&#10;        // 변경 내용은 트랜잭션 종료 시점에 자동 flush&#10;    }&#10;&#10;    /** 계정 삭제 */&#10;    @Transactional&#10;    public void deleteMyAccount(UserDetails userDetails) {&#10;        Users me = getCurrentUser(userDetails);&#10;        userRepository.delete(me);&#10;    }&#10;&#10;    private boolean isValidPasswordlength(String password) {&#10;        if (password == null) return false;&#10;        int len = password.length();&#10;        if (len &lt; 6 || len &gt; 16) return false;&#10;        return true;&#10;    }&#10;    private boolean containsSpecialCh(String password){&#10;        String specialChars = &quot;!@#$%^&amp;*()-_=+[]{}|;:'\&quot;,.&lt;&gt;?/`~&quot;;&#10;        for (char c : password.toCharArray()) {&#10;            if (specialChars.indexOf(c) != -1) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;&#10;    // 제어문자(\n, \t, \r 등) 포함 여부 검사&#10;    private boolean containsControlChar(String input) {&#10;        if (input == null) return false;&#10;        for (char c : input.toCharArray()) {&#10;            if (Character.isISOControl(c)) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/resources/static/mypage.css">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/resources/static/mypage.css" />
              <option name="updatedContent" value="/* 마이페이지 전용 스타일 */&#10;* {&#10;    margin: 0;&#10;    padding: 0;&#10;    box-sizing: border-box;&#10;}&#10;&#10;body {&#10;    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;&#10;    background: #f5f5f5;&#10;    min-height: 100vh;&#10;    padding: 20px;&#10;}&#10;&#10;.card {&#10;    max-width: 400px;&#10;    margin: 0 auto;&#10;    background: white;&#10;    border-radius: 12px;&#10;    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);&#10;    padding: 24px;&#10;    position: relative;&#10;}&#10;&#10;h1 {&#10;    font-size: 24px;&#10;    font-weight: 600;&#10;    color: #333;&#10;    text-align: center;&#10;    margin-bottom: 24px;&#10;}&#10;&#10;/* 탭 스타일 */&#10;.tabs {&#10;    display: flex;&#10;    border-bottom: 1px solid #e9ecef;&#10;    margin-bottom: 24px;&#10;}&#10;&#10;.tabs a {&#10;    flex: 1;&#10;    padding: 12px 16px;&#10;    text-decoration: none;&#10;    color: #6c757d;&#10;    text-align: center;&#10;    border-bottom: 2px solid transparent;&#10;    transition: all 0.2s;&#10;}&#10;&#10;.tabs a.active {&#10;    color: #007bff;&#10;    border-bottom-color: #007bff;&#10;    font-weight: 500;&#10;}&#10;&#10;.tabs a:hover {&#10;    color: #007bff;&#10;    background: #f8f9fa;&#10;}&#10;&#10;/* 아바타 스타일 */&#10;.avatar-wrap {&#10;    display: flex;&#10;    justify-content: center;&#10;    margin-bottom: 32px;&#10;    position: relative;&#10;}&#10;&#10;.avatar {&#10;    width: 80px;&#10;    height: 80px;&#10;    border-radius: 50%;&#10;    background: #e9ecef;&#10;    display: flex;&#10;    align-items: center;&#10;    justify-content: center;&#10;}&#10;&#10;.avatar.placeholder {&#10;    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;}&#10;&#10;.avatar svg {&#10;    fill: white;&#10;}&#10;&#10;.edit-badge {&#10;    position: absolute;&#10;    bottom: 4px;&#10;    right: calc(50% - 48px);&#10;    width: 28px;&#10;    height: 28px;&#10;    background: white;&#10;    border-radius: 50%;&#10;    display: flex;&#10;    align-items: center;&#10;    justify-content: center;&#10;    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);&#10;    cursor: pointer;&#10;    transition: transform 0.2s;&#10;}&#10;&#10;.edit-badge:hover {&#10;    transform: scale(1.1);&#10;}&#10;&#10;/* 폼 요소들 */&#10;.row {&#10;    display: flex;&#10;    align-items: center;&#10;    margin-bottom: 16px;&#10;    gap: 12px;&#10;}&#10;&#10;.label {&#10;    width: 80px;&#10;    font-weight: 500;&#10;    color: #495057;&#10;    font-size: 14px;&#10;}&#10;&#10;.input {&#10;    flex: 1;&#10;    padding: 10px 12px;&#10;    border: 1px solid #dee2e6;&#10;    border-radius: 6px;&#10;    font-size: 14px;&#10;    background: #f8f9fa;&#10;    color: #6c757d;&#10;}&#10;&#10;.input:focus {&#10;    outline: none;&#10;    border-color: #007bff;&#10;    background: white;&#10;    color: #333;&#10;}&#10;&#10;.btn {&#10;    padding: 8px 16px;&#10;    border: 1px solid #007bff;&#10;    border-radius: 6px;&#10;    background: white;&#10;    color: #007bff;&#10;    font-size: 12px;&#10;    font-weight: 500;&#10;    cursor: pointer;&#10;    transition: all 0.2s;&#10;    white-space: nowrap;&#10;}&#10;&#10;.btn:hover {&#10;    background: #007bff;&#10;    color: white;&#10;}&#10;&#10;.btn-primary {&#10;    background: #007bff;&#10;    color: white;&#10;}&#10;&#10;.btn-primary:hover {&#10;    background: #0056b3;&#10;}&#10;&#10;.btn-danger {&#10;    border-color: #dc3545;&#10;    color: #dc3545;&#10;}&#10;&#10;.btn-danger:hover {&#10;    background: #dc3545;&#10;    color: white;&#10;}&#10;&#10;/* 로그아웃 버튼 */&#10;.logout {&#10;    width: 100%;&#10;    padding: 12px;&#10;    border: none;&#10;    border-radius: 8px;&#10;    background: #dc3545;&#10;    color: white;&#10;    font-weight: 500;&#10;    cursor: pointer;&#10;    margin-top: 24px;&#10;    transition: background 0.2s;&#10;}&#10;&#10;.logout:hover {&#10;    background: #c82333;&#10;}&#10;&#10;/* 네비게이션 바 */&#10;.bottom-nav {&#10;    position: fixed;&#10;    bottom: 0;&#10;    left: 0;&#10;    right: 0;&#10;    background: white;&#10;    border-top: 1px solid #dee2e6;&#10;    display: flex;&#10;    padding: 12px 0;&#10;}&#10;&#10;.nav-item {&#10;    flex: 1;&#10;    display: flex;&#10;    flex-direction: column;&#10;    align-items: center;&#10;    text-decoration: none;&#10;    color: #6c757d;&#10;    font-size: 12px;&#10;    gap: 4px;&#10;}&#10;&#10;.nav-item.active {&#10;    color: #007bff;&#10;}&#10;&#10;.nav-item svg {&#10;    width: 24px;&#10;    height: 24px;&#10;}&#10;&#10;/* 설정 페이지 전용 스타일 */&#10;.settings-section {&#10;    margin-bottom: 24px;&#10;}&#10;&#10;.settings-section h3 {&#10;    font-size: 16px;&#10;    font-weight: 600;&#10;    color: #333;&#10;    margin-bottom: 16px;&#10;    padding-bottom: 8px;&#10;    border-bottom: 1px solid #e9ecef;&#10;}&#10;&#10;.setting-item {&#10;    display: flex;&#10;    justify-content: space-between;&#10;    align-items: center;&#10;    padding: 12px 0;&#10;    border-bottom: 1px solid #f8f9fa;&#10;}&#10;&#10;.setting-item:last-child {&#10;    border-bottom: none;&#10;}&#10;&#10;.setting-label {&#10;    font-size: 14px;&#10;    color: #333;&#10;}&#10;&#10;.setting-description {&#10;    font-size: 12px;&#10;    color: #6c757d;&#10;    margin-top: 2px;&#10;}&#10;&#10;.toggle {&#10;    position: relative;&#10;    width: 44px;&#10;    height: 24px;&#10;    background: #dee2e6;&#10;    border-radius: 12px;&#10;    cursor: pointer;&#10;    transition: background 0.2s;&#10;}&#10;&#10;.toggle.active {&#10;    background: #007bff;&#10;}&#10;&#10;.toggle::after {&#10;    content: '';&#10;    position: absolute;&#10;    top: 2px;&#10;    left: 2px;&#10;    width: 20px;&#10;    height: 20px;&#10;    background: white;&#10;    border-radius: 50%;&#10;    transition: transform 0.2s;&#10;}&#10;&#10;.toggle.active::after {&#10;    transform: translateX(20px);&#10;}&#10;&#10;/* 반응형 디자인 */&#10;@media (max-width: 480px) {&#10;    body {&#10;        padding: 12px;&#10;    }&#10;    &#10;    .card {&#10;        padding: 20px;&#10;    }&#10;    &#10;    .row {&#10;        flex-direction: column;&#10;        align-items: stretch;&#10;        gap: 8px;&#10;    }&#10;    &#10;    .label {&#10;        width: 100%;&#10;    }&#10;    &#10;    .btn {&#10;        align-self: flex-end;&#10;        margin-top: 4px;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/main/resources/templates/recent-posts.html">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/main/resources/templates/recent-posts.html" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/Comment/CommentIntergrationTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/Comment/CommentIntergrationTest.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.Comment;&#10;&#10;import com.SYUcap.SYUcap.Board.Board;&#10;import com.SYUcap.SYUcap.Board.BoardRepository;&#10;import com.SYUcap.SYUcap.User.UserRepository;&#10;import com.SYUcap.SYUcap.User.Users;&#10;import jakarta.persistence.EntityManager;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import org.hibernate.SessionFactory;&#10;import org.hibernate.stat.Statistics;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.List;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;&#10;&#10;@SpringBootTest&#10;@AutoConfigureTestDatabase&#10;@org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc(addFilters = false)&#10;class CommentIntergrationTest {&#10;&#10;    @Autowired&#10;    private MockMvc mockMvc;&#10;&#10;    @Autowired&#10;    private CommentRepository commentRepository;&#10;&#10;    @Autowired&#10;    private BoardRepository boardRepository;&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    @Autowired&#10;    private EntityManager em;&#10;&#10;    @Autowired&#10;    private EntityManagerFactory entityManagerFactory;&#10;&#10;    private Board board1;&#10;    private Board board2;&#10;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        // 각 테스트 실행 전에 DB 초기화&#10;        commentRepository.deleteAll();&#10;        boardRepository.deleteAll();&#10;        userRepository.deleteAll();&#10;&#10;        // Given: 게시글 2건 저장&#10;        board1 = new Board();&#10;        board1.setCategory(&quot;게임&quot;);&#10;        board1.setTitle(&quot;게시글 1&quot;);&#10;        boardRepository.save(board1);&#10;&#10;        board2 = new Board();&#10;        board2.setCategory(&quot;스터디&quot;);&#10;        board2.setTitle(&quot;게시글 2&quot;);&#10;        boardRepository.save(board2);&#10;&#10;        // board1에 연결될 기본 사용자 2명 생성&#10;        Users userA = new Users();&#10;        userA.setUserId(&quot;baseUserA&quot;);&#10;        userA.setUserName(&quot;작성자A&quot;);&#10;        userA.setPassword(&quot;pass&quot;);&#10;        userA = userRepository.save(userA);&#10;&#10;        Users userB = new Users();&#10;        userB.setUserId(&quot;baseUserB&quot;);&#10;        userB.setUserName(&quot;작성자B&quot;);&#10;        userB.setPassword(&quot;pass&quot;);&#10;        userB = userRepository.save(userB);&#10;&#10;        // board1용 댓글: 반드시 Users와 연관관계를 맺어 N+1 테스트 시 NPE가 발생하지 않도록 함&#10;        Comment c1 = new Comment();&#10;        c1.setBoard(board1);&#10;        c1.setContent(&quot;1-1&quot;);&#10;        c1.setAuthorName(userA.getUserName());&#10;        c1.setUser(userA);&#10;&#10;        Comment c2 = new Comment();&#10;        c2.setBoard(board1);&#10;        c2.setContent(&quot;1-2&quot;);&#10;        c2.setAuthorName(userB.getUserName());&#10;        c2.setUser(userB);&#10;&#10;        // board2 댓글은 N+1 성능 테스트와 직접 관련 없으므로 user 연관 여부는 선택 사항&#10;        Comment c3 = new Comment();&#10;        c3.setBoard(board2);&#10;        c3.setContent(&quot;2-1&quot;);&#10;        c3.setAuthorName(&quot;C&quot;);&#10;&#10;        commentRepository.saveAll(List.of(c1, c2, c3));&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;[C-001] content 파라미터 누락 시 400, DB 저장 없음&quot;)&#10;    void addComment_MissingContent_BadRequest() throws Exception {&#10;        // Given: 게시글 존재, 현재 댓글 수 기록&#10;        long before = commentRepository.count();&#10;&#10;        // When: content 파라미터 없이 POST 요청&#10;        mockMvc.perform(post(&quot;/board/게임/&quot; + board1.getId() + &quot;/comment&quot;))&#10;                // Then: 400 Bad Request&#10;                .andExpect(status().isBadRequest());&#10;&#10;        // And: DB 저장 없음&#10;        long after = commentRepository.count();&#10;        assertThat(after).isEqualTo(before);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;[C-002] content 빈 문자열 전송 시 302 Redirect 및 DB 저장&quot;)&#10;    void addComment_EmptyContent_RedirectAndSaved() throws Exception {&#10;        // Given: 현재 댓글 수 기록&#10;        long before = commentRepository.count();&#10;&#10;        // When: content=&quot;&quot;로 POST 요청&#10;        mockMvc.perform(post(&quot;/board/게임/&quot; + board1.getId() + &quot;/comment&quot;)&#10;                        .param(&quot;content&quot;, &quot;&quot;))&#10;                // Then: 3xx Redirect (컨트롤러 리다이렉트 정책)&#10;                .andExpect(status().is3xxRedirection());&#10;&#10;        // And: DB에 1건 저장됨&#10;        long after = commentRepository.count();&#10;        assertThat(after).isEqualTo(before + 1);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;[R-005] 댓글 조회 N+1 성능 검증 (JOIN FETCH - 쿼리 개수 검증)&quot;)&#10;    @Transactional&#10;    void getComments_FetchJoin_NoAdditionalSelect() {&#10;        // Given: 동일 게시글에 서로 다른 작성자(Users)로 연결된 댓글 10건 저장&#10;        for (int i = 0; i &lt; 10; i++) {&#10;            Users u = new Users();&#10;            u.setUserId(&quot;user&quot; + i);&#10;            u.setUserName(&quot;작성자&quot; + i);&#10;            u.setPassword(&quot;pass&quot;);&#10;            u = userRepository.save(u);&#10;&#10;            Comment c = new Comment();&#10;            c.setBoard(board1);&#10;            c.setContent(&quot;댓글&quot; + i);&#10;            c.setAuthorName(u.getUserName());&#10;            c.setUser(u);&#10;            commentRepository.save(c);&#10;        }&#10;&#10;        // [중요] 영속성 컨텍스트 초기화 (캐시가 아닌 실제 DB 조회를 강제하기 위함)&#10;        em.flush();&#10;        em.clear();&#10;&#10;        // [1] Hibernate 통계 객체 준비 및 초기화&#10;        SessionFactory sessionFactory = entityManagerFactory.unwrap(SessionFactory.class);&#10;        Statistics statistics = sessionFactory.getStatistics();&#10;        statistics.setStatisticsEnabled(true);&#10;        statistics.clear(); // 기존 쿼리 기록 삭제&#10;&#10;        System.out.println(&quot;=== [검증 시작] 쿼리 카운트 측정 ===&quot;);&#10;&#10;        // When: 페치 조인으로 댓글 목록 조회&#10;        List&lt;Comment&gt; comments = commentRepository.findByBoardIdWithUserFetchJoin(board1.getId());&#10;&#10;        // [2] 지연 로딩 여부 확인: 연관된 User 객체를 실제로 건드려봄&#10;        for (Comment c : comments) {&#10;            // 만약 Fetch Join이 실패했다면, 여기서 루프 돌 때마다 SELECT 쿼리가 발생함 (N+1)&#10;            c.getUser().getUserName();&#10;        }&#10;&#10;        System.out.println(&quot;=== [검증 종료] ===&quot;);&#10;&#10;        // Then: 실행된 쿼리 개수가 정확히 1개인지 검증&#10;        long queryCount = statistics.getPrepareStatementCount();&#10;        System.out.println(&quot;발생한 총 쿼리 수: &quot; + queryCount);&#10;&#10;        // 성공 기준: 목록 조회(JOIN FETCH) 1번만 실행되어야 함&#10;        assertThat(queryCount).isEqualTo(1L);&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.Comment;&#10;&#10;import com.SYUcap.SYUcap.Board.Board;&#10;import com.SYUcap.SYUcap.Board.BoardRepository;&#10;import com.SYUcap.SYUcap.User.UserRepository;&#10;import com.SYUcap.SYUcap.User.Users;&#10;import jakarta.persistence.EntityManager;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import org.hibernate.SessionFactory;&#10;import org.hibernate.stat.Statistics;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.List;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;&#10;&#10;@SpringBootTest&#10;@AutoConfigureTestDatabase&#10;@org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc(addFilters = false)&#10;class CommentIntergrationTest {&#10;&#10;    @Autowired&#10;    private MockMvc mockMvc;&#10;&#10;    @Autowired&#10;    private CommentRepository commentRepository;&#10;&#10;    @Autowired&#10;    private BoardRepository boardRepository;&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    @Autowired&#10;    private EntityManager em;&#10;&#10;    @Autowired&#10;    private EntityManagerFactory entityManagerFactory;&#10;&#10;    private Board board1;&#10;    private Board board2;&#10;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        // 각 테스트 실행 전에 DB 초기화&#10;        commentRepository.deleteAll();&#10;        boardRepository.deleteAll();&#10;        userRepository.deleteAll();&#10;&#10;        // Given: 게시글 2건 저장&#10;        board1 = new Board();&#10;        board1.setCategory(&quot;게임&quot;);&#10;        board1.setTitle(&quot;게시글 1&quot;);&#10;        boardRepository.save(board1);&#10;&#10;        board2 = new Board();&#10;        board2.setCategory(&quot;스터디&quot;);&#10;        board2.setTitle(&quot;게시글 2&quot;);&#10;        boardRepository.save(board2);&#10;&#10;        // baseUserA, baseUserB의 userId가 중복되지 않도록 매 세트마다 고유한 suffix 부여&#10;        long existingUserCount = userRepository.count();&#10;&#10;        Users userA = new Users();&#10;        userA.setUserId(&quot;baseUserA_&quot; + existingUserCount);&#10;        userA.setUserName(&quot;작성자A&quot;);&#10;        userA.setPassword(&quot;pass&quot;);&#10;        userA = userRepository.save(userA);&#10;&#10;        Users userB = new Users();&#10;        userB.setUserId(&quot;baseUserB_&quot; + existingUserCount);&#10;        userB.setUserName(&quot;작성자B&quot;);&#10;        userB.setPassword(&quot;pass&quot;);&#10;        userB = userRepository.save(userB);&#10;&#10;        // board1용 댓글: 반드시 Users와 연관관계를 맺어 N+1 테스트 시 NPE가 발생하지 않도록 함&#10;        Comment c1 = new Comment();&#10;        c1.setBoard(board1);&#10;        c1.setContent(&quot;1-1&quot;);&#10;        c1.setAuthorName(userA.getUserName());&#10;        c1.setUser(userA);&#10;&#10;        Comment c2 = new Comment();&#10;        c2.setBoard(board1);&#10;        c2.setContent(&quot;1-2&quot;);&#10;        c2.setAuthorName(userB.getUserName());&#10;        c2.setUser(userB);&#10;&#10;        // board2 댓글은 N+1 성능 테스트와 직접 관련 없으므로 user 연관 여부는 선택 사항&#10;        Comment c3 = new Comment();&#10;        c3.setBoard(board2);&#10;        c3.setContent(&quot;2-1&quot;);&#10;        c3.setAuthorName(&quot;C&quot;);&#10;&#10;        commentRepository.saveAll(List.of(c1, c2, c3));&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;[C-001] content 파라미터 누락 시 400, DB 저장 없음&quot;)&#10;    void addComment_MissingContent_BadRequest() throws Exception {&#10;        // Given: 게시글 존재, 현재 댓글 수 기록&#10;        long before = commentRepository.count();&#10;&#10;        // When: content 파라미터 없이 POST 요청&#10;        mockMvc.perform(post(&quot;/board/게임/&quot; + board1.getId() + &quot;/comment&quot;))&#10;                // Then: 400 Bad Request&#10;                .andExpect(status().isBadRequest());&#10;&#10;        // And: DB 저장 없음&#10;        long after = commentRepository.count();&#10;        assertThat(after).isEqualTo(before);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;[C-002] content 빈 문자열 전송 시 302 Redirect 및 DB 저장&quot;)&#10;    void addComment_EmptyContent_RedirectAndSaved() throws Exception {&#10;        // Given: 현재 댓글 수 기록&#10;        long before = commentRepository.count();&#10;&#10;        // When: content=&quot;&quot;로 POST 요청&#10;        mockMvc.perform(post(&quot;/board/게임/&quot; + board1.getId() + &quot;/comment&quot;)&#10;                        .param(&quot;content&quot;, &quot;&quot;))&#10;                // Then: 3xx Redirect (컨트롤러 리다이렉트 정책)&#10;                .andExpect(status().is3xxRedirection());&#10;&#10;        // And: DB에 1건 저장됨&#10;        long after = commentRepository.count();&#10;        assertThat(after).isEqualTo(before + 1);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;[R-005] 댓글 조회 N+1 성능 검증 (JOIN FETCH - 쿼리 개수 검증)&quot;)&#10;    @Transactional&#10;    void getComments_FetchJoin_NoAdditionalSelect() {&#10;        // Given: 동일 게시글에 서로 다른 작성자(Users)로 연결된 댓글 10건 저장&#10;        for (int i = 0; i &lt; 10; i++) {&#10;            Users u = new Users();&#10;            u.setUserId(&quot;user&quot; + i);&#10;            u.setUserName(&quot;작성자&quot; + i);&#10;            u.setPassword(&quot;pass&quot;);&#10;            u = userRepository.save(u);&#10;&#10;            Comment c = new Comment();&#10;            c.setBoard(board1);&#10;            c.setContent(&quot;댓글&quot; + i);&#10;            c.setAuthorName(u.getUserName());&#10;            c.setUser(u);&#10;            commentRepository.save(c);&#10;        }&#10;&#10;        // [중요] 영속성 컨텍스트 초기화 (캐시가 아닌 실제 DB 조회를 강제하기 위함)&#10;        em.flush();&#10;        em.clear();&#10;&#10;        // [1] Hibernate 통계 객체 준비 및 초기화&#10;        SessionFactory sessionFactory = entityManagerFactory.unwrap(SessionFactory.class);&#10;        Statistics statistics = sessionFactory.getStatistics();&#10;        statistics.setStatisticsEnabled(true);&#10;        statistics.clear(); // 기존 쿼리 기록 삭제&#10;&#10;        System.out.println(&quot;=== [검증 시작] 쿼리 카운트 측정 ===&quot;);&#10;&#10;        // When: 페치 조인으로 댓글 목록 조회&#10;        List&lt;Comment&gt; comments = commentRepository.findByBoardIdWithUserFetchJoin(board1.getId());&#10;&#10;        // [2] 지연 로딩 여부 확인: 연관된 User 객체를 실제로 건드려봄&#10;        for (Comment c : comments) {&#10;            // 만약 Fetch Join이 실패했다면, 여기서 루프 돌 때마다 SELECT 쿼리가 발생함 (N+1)&#10;            c.getUser().getUserName();&#10;        }&#10;&#10;        System.out.println(&quot;=== [검증 종료] ===&quot;);&#10;&#10;        // Then: 실행된 쿼리 개수가 정확히 1개인지 검증&#10;        long queryCount = statistics.getPrepareStatementCount();&#10;        System.out.println(&quot;발생한 총 쿼리 수: &quot; + queryCount);&#10;&#10;        // 성공 기준: 목록 조회(JOIN FETCH) 1번만 실행되어야 함&#10;        assertThat(queryCount).isEqualTo(1L);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/Group/GroupIntegrationTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/Group/GroupIntegrationTest.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.Group;&#10;&#10;import com.SYUcap.SYUcap.Board.Board;&#10;import com.SYUcap.SYUcap.Board.BoardRepository;&#10;import com.SYUcap.SYUcap.GroupMember.GroupMembers;&#10;import com.SYUcap.SYUcap.GroupMember.GroupMembersRepository;&#10;import com.SYUcap.SYUcap.JoinRequest.JoinRequestService;&#10;import com.SYUcap.SYUcap.JoinRequest.JoinRequests;&#10;import com.SYUcap.SYUcap.JoinRequest.JoinRequestsRepository;&#10;import com.SYUcap.SYUcap.User.Users;&#10;import com.SYUcap.SYUcap.User.UserRepository;&#10;import jakarta.persistence.EntityManager;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;&#10;import static org.assertj.core.api.Assertions.*;&#10;&#10;&#10;@SpringBootTest&#10;@Transactional&#10;@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.ANY)&#10;class GroupIntegrationTest {&#10;&#10;    @Autowired&#10;    private GroupService groupService;&#10;&#10;    @Autowired&#10;    private GroupsRepository groupsRepository;&#10;&#10;    @Autowired&#10;    private GroupMembersRepository groupMembersRepository;&#10;&#10;    @Autowired&#10;    private BoardRepository boardRepository;&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    @Autowired&#10;    private JoinRequestService joinRequestService;&#10;&#10;    @Autowired&#10;    private JoinRequestsRepository joinRequestsRepository;&#10;&#10;    @Autowired&#10;    private EntityManager entityManager;&#10;&#10;    private Users testUser;&#10;    private Board testBoard;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        // 테스트용 사용자 생성&#10;        testUser = new Users();&#10;        testUser.setUserId(&quot;testuser&quot;);&#10;        testUser.setPassword(&quot;password123!&quot;);&#10;        testUser.setUserName(&quot;테스트유저&quot;);&#10;        testUser = userRepository.save(testUser);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-001: 게시글 작성 시 그룹 자동 생성&quot;)&#10;    void testCreateGroupFromBoard() {&#10;        // Given: 게시글 데이터 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        // When: 그룹 자동 생성&#10;        Groups createdGroup = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // Then: 검증&#10;        // 1. Groups가 생성되었는가?&#10;        assertThat(createdGroup).isNotNull();&#10;        assertThat(createdGroup.getId()).isNotNull();&#10;&#10;        // 2. 그룹 정보가 올바른가?&#10;        assertThat(createdGroup.getCurrentCount()).isEqualTo(1);&#10;        assertThat(createdGroup.getStatus()).isEqualTo(&quot;ACTIVE&quot;);&#10;        assertThat(createdGroup.getBoard().getId()).isEqualTo(testBoard.getId());&#10;&#10;        // 3. 그룹장(LEADER)이 자동으로 등록되었는가?&#10;        Optional&lt;GroupMembers&gt; leaderOpt = groupMembersRepository&#10;                .findAll()&#10;                .stream()&#10;                .filter(gm -&gt; gm.getGroup().getId().equals(createdGroup.getId())&#10;                        &amp;&amp; gm.getUser().getId().equals(testUser.getId()))&#10;                .findFirst();&#10;&#10;        assertThat(leaderOpt).isPresent();&#10;        GroupMembers leader = leaderOpt.get();&#10;        assertThat(leader.getRole()).isEqualTo(&quot;LEADER&quot;);&#10;        assertThat(leader.getUser().getId()).isEqualTo(testUser.getId());&#10;&#10;        // 4. DB에 실제로 저장되었는가?&#10;        Optional&lt;Groups&gt; savedGroup = groupsRepository.findById(createdGroup.getId());&#10;        assertThat(savedGroup).isPresent();&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-003: 제한 인원 도달 시 자동 마감&quot;)&#10;    void testGroupAutoClose() {&#10;        // Given: 제한 인원 5명인 그룹 생성&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(group.getCurrentCount()).isEqualTo(1);&#10;        assertThat(group.getStatus()).isEqualTo(&quot;ACTIVE&quot;);&#10;&#10;        // When: 4명의 멤버를 추가 (총 5명이 되도록)&#10;        for (int i = 1; i &lt;= 4; i++) {&#10;            Users newUser = new Users();&#10;            newUser.setUserId(&quot;user&quot; + i);&#10;            newUser.setPassword(&quot;password123!&quot;);&#10;            newUser.setUserName(&quot;사용자&quot; + i);&#10;            newUser = userRepository.save(newUser);&#10;&#10;            GroupMembers member = new GroupMembers(newUser, group, &quot;MEMBER&quot;);&#10;            groupMembersRepository.save(member);&#10;&#10;            group.incrementCurrentCount();&#10;        }&#10;        groupsRepository.save(group);&#10;&#10;        // Then: 검증&#10;        // 1. 현재 인원이 5명인가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(5);&#10;&#10;        // 2. 그룹 상태가 자동으로 CLOSED로 변경되었는가?&#10;        assertThat(updatedGroup.getStatus()).isEqualTo(&quot;CLOSED&quot;);&#10;&#10;        // 3. isFull() 메서드가 true를 반환하는가?&#10;        assertThat(updatedGroup.isFull()).isTrue();&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-005: 그룹장의 멤버 강제 퇴장&quot;)&#10;    void testKickMember() {&#10;        // Given: 그룹과 일반 멤버 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // 일반 멤버 추가&#10;        Users member = new Users();&#10;        member.setUserId(&quot;member1&quot;);&#10;        member.setPassword(&quot;password123!&quot;);&#10;        member.setUserName(&quot;일반멤버&quot;);&#10;        member = userRepository.save(member);&#10;&#10;        GroupMembers groupMember = new GroupMembers(member, group, &quot;MEMBER&quot;);&#10;        groupMembersRepository.save(groupMember);&#10;&#10;        group.incrementCurrentCount();&#10;        groupsRepository.save(group);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(group.getCurrentCount()).isEqualTo(2); // 그룹장 + 멤버 1명&#10;&#10;        // When: 그룹장이 멤버 강제 퇴장&#10;        groupService.kickMember(member.id, group.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. GroupMembers에서 삭제되었는가?&#10;        Optional&lt;GroupMembers&gt; kickedMember = groupMembersRepository&#10;                .findByUserIdAndGroupId(member.id, group.getId());&#10;        assertThat(kickedMember).isEmpty();&#10;&#10;        // 2. currentCount가 감소했는가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(1); // 그룹장만 남음&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-006: 그룹장 권한 위임&quot;)&#10;    void testTransferLeadership() {&#10;        // Given: 그룹과 일반 멤버 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // 일반 멤버 추가&#10;        Users newLeader = new Users();&#10;        newLeader.setUserId(&quot;newleader&quot;);&#10;        newLeader.setPassword(&quot;password123!&quot;);&#10;        newLeader.setUserName(&quot;신규리더&quot;);&#10;        newLeader = userRepository.save(newLeader);&#10;&#10;        GroupMembers newLeaderMember = new GroupMembers(newLeader, group, &quot;MEMBER&quot;);&#10;        groupMembersRepository.save(newLeaderMember);&#10;&#10;        // When: 그룹장 권한 위임&#10;        groupService.transferLeadership(testUser.id, newLeader.id, group.getId());&#10;&#10;        // Then: 검증&#10;        // 1. 기존 그룹장이 MEMBER로 변경되었는가?&#10;        Optional&lt;GroupMembers&gt; oldLeaderOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(testUser.id, group.getId());&#10;        assertThat(oldLeaderOpt).isPresent();&#10;        assertThat(oldLeaderOpt.get().getRole()).isEqualTo(&quot;MEMBER&quot;);&#10;&#10;        // 2. 새 멤버가 LEADER로 변경되었는가?&#10;        Optional&lt;GroupMembers&gt; newLeaderOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(newLeader.id, group.getId());&#10;        assertThat(newLeaderOpt).isPresent();&#10;        assertThat(newLeaderOpt.get().getRole()).isEqualTo(&quot;LEADER&quot;);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-007: 그룹장이 수동으로 그룹 마감&quot;)&#10;    void testCloseGroup() {&#10;        // Given: 그룹과 대기 중인 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;&#10;        // 대기 중인 가입 신청 3건 추가&#10;        List&lt;Users&gt; applicants = new ArrayList&lt;&gt;();&#10;        for (int i = 1; i &lt;= 3; i++) {&#10;            Users applicant = new Users();&#10;            applicant.setUserId(&quot;applicant&quot; + i);&#10;            applicant.setPassword(&quot;password123!&quot;);&#10;            applicant.setUserName(&quot;신청자&quot; + i);&#10;            applicant = userRepository.save(applicant);&#10;            applicants.add(applicant);&#10;&#10;            JoinRequests request = new JoinRequests(applicant, group, &quot;가입 신청!&quot;);&#10;            joinRequestsRepository.save(request);&#10;        }&#10;&#10;        // 초기 상태 확인&#10;        assertThat(group.getStatus()).isEqualTo(&quot;ACTIVE&quot;);&#10;&#10;        // When: 그룹장이 그룹 마감&#10;        groupService.closeGroup(group.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. 그룹 상태가 CLOSED로 변경되었는가?&#10;        Groups closedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(closedGroup).isNotNull();&#10;        assertThat(closedGroup.getStatus()).isEqualTo(&quot;CLOSED&quot;);&#10;&#10;        // 2. 모든 대기 신청이 REJECTED로 변경되었는가?&#10;        List&lt;JoinRequests&gt; rejectedRequests = joinRequestsRepository&#10;                .findByGroupIdAndStatusOrderByRequestedAtDesc(group.getId(), &quot;REJECTED&quot;);&#10;        assertThat(rejectedRequests).hasSize(3);&#10;&#10;        for (JoinRequests request : rejectedRequests) {&#10;            assertThat(request.getStatus()).isEqualTo(&quot;REJECTED&quot;);&#10;            assertThat(request.getProcessedAt()).isNotNull();&#10;        }&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-013: 가입 신청 승인 후 멤버 추가&quot;)&#10;    void testApproveJoinRequest() {&#10;        // Given: 그룹과 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;&#10;        // 가입 신청자 생성&#10;        Users applicant = new Users();&#10;        applicant.setUserId(&quot;applicant&quot;);&#10;        applicant.setPassword(&quot;password123!&quot;);&#10;        applicant.setUserName(&quot;신청자&quot;);&#10;        applicant = userRepository.save(applicant);&#10;&#10;        // 가입 신청 생성&#10;        JoinRequests joinRequest = new JoinRequests(applicant, group, &quot;가입하고 싶습니다!&quot;);&#10;        joinRequest = joinRequestsRepository.save(joinRequest);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(joinRequest.getStatus()).isEqualTo(&quot;PENDING&quot;);&#10;        assertThat(group.getCurrentCount()).isEqualTo(1);&#10;&#10;        // When: 그룹장이 승인&#10;        joinRequestService.approveJoinRequest(joinRequest.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. 신청 상태가 APPROVED로 변경되었는가?&#10;        JoinRequests approvedRequest = joinRequestsRepository.findById(joinRequest.getId()).orElse(null);&#10;        assertThat(approvedRequest).isNotNull();&#10;        assertThat(approvedRequest.getStatus()).isEqualTo(&quot;APPROVED&quot;);&#10;        assertThat(approvedRequest.getProcessedBy().id).isEqualTo(testUser.id);&#10;&#10;        // 2. GroupMembers에 추가되었는가?&#10;        Optional&lt;GroupMembers&gt; newMemberOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(applicant.id, group.getId());&#10;        assertThat(newMemberOpt).isPresent();&#10;        assertThat(newMemberOpt.get().getRole()).isEqualTo(&quot;MEMBER&quot;);&#10;&#10;        // 3. currentCount가 증가했는가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(2);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-014: 가입 신청 거절&quot;)&#10;    void testRejectJoinRequest() {&#10;        // Given: 그룹과 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;&#10;        // 가입 신청자 생성&#10;        Users applicant = new Users();&#10;        applicant.setUserId(&quot;applicant&quot;);&#10;        applicant.setPassword(&quot;password123!&quot;);&#10;        applicant.setUserName(&quot;신청자&quot;);&#10;        applicant = userRepository.save(applicant);&#10;&#10;        // 가입 신청 생성&#10;        JoinRequests joinRequest = new JoinRequests(applicant, group, &quot;가입하고 싶습니다!&quot;);&#10;        joinRequest = joinRequestsRepository.save(joinRequest);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(joinRequest.getStatus()).isEqualTo(&quot;PENDING&quot;);&#10;        assertThat(group.getCurrentCount()).isEqualTo(1);&#10;&#10;        // When: 그룹장이 거절&#10;        joinRequestService.rejectJoinRequest(joinRequest.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. 신청 상태가 REJECTED로 변경되었는가?&#10;        JoinRequests rejectedRequest = joinRequestsRepository.findById(joinRequest.getId()).orElse(null);&#10;        assertThat(rejectedRequest).isNotNull();&#10;        assertThat(rejectedRequest.getStatus()).isEqualTo(&quot;REJECTED&quot;);&#10;        assertThat(rejectedRequest.getProcessedBy().id).isEqualTo(testUser.id);&#10;&#10;        // 2. GroupMembers에 추가되지 않았는가?&#10;        Optional&lt;GroupMembers&gt; memberOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(applicant.id, group.getId());&#10;        assertThat(memberOpt).isEmpty();&#10;&#10;        // 3. currentCount가 유지되는가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(1); // 그룹장만&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-022: 그룹장이 마감 중 다른 관리자가 신청 승인&quot;)&#10;    void testConcurrentCloseAndApprove() throws InterruptedException {&#10;        // Given: 그룹과 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;        Long groupId = group.getId();&#10;&#10;        // 가입 신청자 생성&#10;        Users applicant = new Users();&#10;        applicant.setUserId(&quot;applicant&quot;);&#10;        applicant.setPassword(&quot;password123!&quot;);&#10;        applicant.setUserName(&quot;신청자&quot;);&#10;        applicant = userRepository.save(applicant);&#10;&#10;        // 가입 신청 생성&#10;        JoinRequests joinRequest = new JoinRequests(applicant, group, &quot;가입 신청!&quot;);&#10;        joinRequest = joinRequestsRepository.save(joinRequest);&#10;        Long requestId = joinRequest.getId();&#10;&#10;        System.out.println(&quot;=== 초기 상태 ===&quot;);&#10;        System.out.println(&quot;그룹 상태: &quot; + group.getStatus());&#10;        System.out.println(&quot;신청 상태: &quot; + joinRequest.getStatus());&#10;&#10;        // When: 순차적으로 실행 (동시성은 실제 서버 환경에서 테스트)&#10;        // 1. 먼저 마감 시도&#10;        try {&#10;            groupService.closeGroup(groupId, testUser.id);&#10;            System.out.println(&quot;그룹 마감 성공&quot;);&#10;        } catch (Exception e) {&#10;            System.out.println(&quot;그룹 마감 실패: &quot; + e.getMessage());&#10;        }&#10;&#10;        // 2. 그 다음 승인 시도 (마감된 그룹에 승인 시도)&#10;        try {&#10;            joinRequestService.approveJoinRequest(requestId, testUser.id);&#10;            System.out.println(&quot;신청 승인 성공&quot;);&#10;        } catch (Exception e) {&#10;            System.out.println(&quot;신청 승인 실패: &quot; + e.getMessage());&#10;        }&#10;&#10;        // Then: 검증&#10;        Groups finalGroup = groupsRepository.findById(groupId).orElse(null);&#10;        JoinRequests finalRequest = joinRequestsRepository.findById(requestId).orElse(null);&#10;&#10;        System.out.println(&quot;\n=== TC-G-022 결과 ===&quot;);&#10;        System.out.println(&quot;최종 그룹 상태: &quot; + (finalGroup != null ? finalGroup.getStatus() : &quot;null&quot;));&#10;        System.out.println(&quot;최종 신청 상태: &quot; + (finalRequest != null ? finalRequest.getStatus() : &quot;null&quot;));&#10;&#10;        // 1. 그룹이 CLOSED 상태인가?&#10;        assertThat(finalGroup).isNotNull();&#10;        assertThat(finalGroup.getStatus()).isEqualTo(&quot;CLOSED&quot;);&#10;&#10;        // 2. 대기 신청이 REJECTED로 변경되었는가?&#10;        assertThat(finalRequest).isNotNull();&#10;        assertThat(finalRequest.getStatus()).isEqualTo(&quot;REJECTED&quot;);&#10;&#10;        // 3. 승인 시도는 실패해야 함 (이미 처리된 신청)&#10;        System.out.println(&quot;마감 후 대기 신청이 자동으로 거절됨 - 정상 동작&quot;);&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.Group;&#10;&#10;import com.SYUcap.SYUcap.Board.Board;&#10;import com.SYUcap.SYUcap.Board.BoardRepository;&#10;import com.SYUcap.SYUcap.GroupMember.GroupMembers;&#10;import com.SYUcap.SYUcap.GroupMember.GroupMembersRepository;&#10;import com.SYUcap.SYUcap.JoinRequest.JoinRequestService;&#10;import com.SYUcap.SYUcap.JoinRequest.JoinRequests;&#10;import com.SYUcap.SYUcap.JoinRequest.JoinRequestsRepository;&#10;import com.SYUcap.SYUcap.User.Users;&#10;import com.SYUcap.SYUcap.User.UserRepository;&#10;import jakarta.persistence.EntityManager;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;&#10;import static org.assertj.core.api.Assertions.*;&#10;&#10;&#10;@SpringBootTest&#10;@Transactional&#10;@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.ANY)&#10;class GroupIntegrationTest {&#10;&#10;    @Autowired&#10;    private GroupService groupService;&#10;&#10;    @Autowired&#10;    private GroupsRepository groupsRepository;&#10;&#10;    @Autowired&#10;    private GroupMembersRepository groupMembersRepository;&#10;&#10;    @Autowired&#10;    private BoardRepository boardRepository;&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    @Autowired&#10;    private JoinRequestService joinRequestService;&#10;&#10;    @Autowired&#10;    private JoinRequestsRepository joinRequestsRepository;&#10;&#10;    @Autowired&#10;    private EntityManager entityManager;&#10;&#10;    private Users testUser;&#10;    private Board testBoard;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        // 이전 테스트 데이터 정리 (유저/게시글/그룹 관련 엔티티 순으로 삭제)&#10;        // 그룹 연관 관계를 고려해 순서 주의: 그룹 멤버/가입요청 -&gt; 그룹 -&gt; 게시글 -&gt; 유저&#10;        joinRequestsRepository.deleteAll();&#10;        groupMembersRepository.deleteAll();&#10;        groupsRepository.deleteAll();&#10;        boardRepository.deleteAll();&#10;        userRepository.deleteAll();&#10;&#10;        // 테스트용 사용자 생성 - userId를 매 테스트마다 유일하게 설정&#10;        long userCount = userRepository.count();&#10;        testUser = new Users();&#10;        testUser.setUserId(&quot;testuser_&quot; + userCount);&#10;        testUser.setPassword(&quot;password123!&quot;);&#10;        testUser.setUserName(&quot;테스트유저&quot;);&#10;        testUser = userRepository.save(testUser);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-001: 게시글 작성 시 그룹 자동 생성&quot;)&#10;    void testCreateGroupFromBoard() {&#10;        // Given: 게시글 데이터 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        // When: 그룹 자동 생성&#10;        Groups createdGroup = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // Then: 검증&#10;        // 1. Groups가 생성되었는가?&#10;        assertThat(createdGroup).isNotNull();&#10;        assertThat(createdGroup.getId()).isNotNull();&#10;&#10;        // 2. 그룹 정보가 올바른가?&#10;        assertThat(createdGroup.getCurrentCount()).isEqualTo(1);&#10;        assertThat(createdGroup.getStatus()).isEqualTo(&quot;ACTIVE&quot;);&#10;        assertThat(createdGroup.getBoard().getId()).isEqualTo(testBoard.getId());&#10;&#10;        // 3. 그룹장(LEADER)이 자동으로 등록되었는가?&#10;        Optional&lt;GroupMembers&gt; leaderOpt = groupMembersRepository&#10;                .findAll()&#10;                .stream()&#10;                .filter(gm -&gt; gm.getGroup().getId().equals(createdGroup.getId())&#10;                        &amp;&amp; gm.getUser().getId().equals(testUser.getId()))&#10;                .findFirst();&#10;&#10;        assertThat(leaderOpt).isPresent();&#10;        GroupMembers leader = leaderOpt.get();&#10;        assertThat(leader.getRole()).isEqualTo(&quot;LEADER&quot;);&#10;        assertThat(leader.getUser().getId()).isEqualTo(testUser.getId());&#10;&#10;        // 4. DB에 실제로 저장되었는가?&#10;        Optional&lt;Groups&gt; savedGroup = groupsRepository.findById(createdGroup.getId());&#10;        assertThat(savedGroup).isPresent();&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-003: 제한 인원 도달 시 자동 마감&quot;)&#10;    void testGroupAutoClose() {&#10;        // Given: 제한 인원 5명인 그룹 생성&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(group.getCurrentCount()).isEqualTo(1);&#10;        assertThat(group.getStatus()).isEqualTo(&quot;ACTIVE&quot;);&#10;&#10;        // When: 4명의 멤버를 추가 (총 5명이 되도록)&#10;        for (int i = 1; i &lt;= 4; i++) {&#10;            Users newUser = new Users();&#10;            newUser.setUserId(&quot;user&quot; + i);&#10;            newUser.setPassword(&quot;password123!&quot;);&#10;            newUser.setUserName(&quot;사용자&quot; + i);&#10;            newUser = userRepository.save(newUser);&#10;&#10;            GroupMembers member = new GroupMembers(newUser, group, &quot;MEMBER&quot;);&#10;            groupMembersRepository.save(member);&#10;&#10;            group.incrementCurrentCount();&#10;        }&#10;        groupsRepository.save(group);&#10;&#10;        // Then: 검증&#10;        // 1. 현재 인원이 5명인가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(5);&#10;&#10;        // 2. 그룹 상태가 자동으로 CLOSED로 변경되었는가?&#10;        assertThat(updatedGroup.getStatus()).isEqualTo(&quot;CLOSED&quot;);&#10;&#10;        // 3. isFull() 메서드가 true를 반환하는가?&#10;        assertThat(updatedGroup.isFull()).isTrue();&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-005: 그룹장의 멤버 강제 퇴장&quot;)&#10;    void testKickMember() {&#10;        // Given: 그룹과 일반 멤버 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // 일반 멤버 추가&#10;        Users member = new Users();&#10;        member.setUserId(&quot;member1&quot;);&#10;        member.setPassword(&quot;password123!&quot;);&#10;        member.setUserName(&quot;일반멤버&quot;);&#10;        member = userRepository.save(member);&#10;&#10;        GroupMembers groupMember = new GroupMembers(member, group, &quot;MEMBER&quot;);&#10;        groupMembersRepository.save(groupMember);&#10;&#10;        group.incrementCurrentCount();&#10;        groupsRepository.save(group);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(group.getCurrentCount()).isEqualTo(2); // 그룹장 + 멤버 1명&#10;&#10;        // When: 그룹장이 멤버 강제 퇴장&#10;        groupService.kickMember(member.id, group.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. GroupMembers에서 삭제되었는가?&#10;        Optional&lt;GroupMembers&gt; kickedMember = groupMembersRepository&#10;                .findByUserIdAndGroupId(member.id, group.getId());&#10;        assertThat(kickedMember).isEmpty();&#10;&#10;        // 2. currentCount가 감소했는가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(1); // 그룹장만 남음&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-006: 그룹장 권한 위임&quot;)&#10;    void testTransferLeadership() {&#10;        // Given: 그룹과 일반 멤버 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;&#10;        // 일반 멤버 추가&#10;        Users newLeader = new Users();&#10;        newLeader.setUserId(&quot;newleader&quot;);&#10;        newLeader.setPassword(&quot;password123!&quot;);&#10;        newLeader.setUserName(&quot;신규리더&quot;);&#10;        newLeader = userRepository.save(newLeader);&#10;&#10;        GroupMembers newLeaderMember = new GroupMembers(newLeader, group, &quot;MEMBER&quot;);&#10;        groupMembersRepository.save(newLeaderMember);&#10;&#10;        // When: 그룹장 권한 위임&#10;        groupService.transferLeadership(testUser.id, newLeader.id, group.getId());&#10;&#10;        // Then: 검증&#10;        // 1. 기존 그룹장이 MEMBER로 변경되었는가?&#10;        Optional&lt;GroupMembers&gt; oldLeaderOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(testUser.id, group.getId());&#10;        assertThat(oldLeaderOpt).isPresent();&#10;        assertThat(oldLeaderOpt.get().getRole()).isEqualTo(&quot;MEMBER&quot;);&#10;&#10;        // 2. 새 멤버가 LEADER로 변경되었는가?&#10;        Optional&lt;GroupMembers&gt; newLeaderOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(newLeader.id, group.getId());&#10;        assertThat(newLeaderOpt).isPresent();&#10;        assertThat(newLeaderOpt.get().getRole()).isEqualTo(&quot;LEADER&quot;);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-007: 그룹장이 수동으로 그룹 마감&quot;)&#10;    void testCloseGroup() {&#10;        // Given: 그룹과 대기 중인 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;&#10;        // 대기 중인 가입 신청 3건 추가&#10;        List&lt;Users&gt; applicants = new ArrayList&lt;&gt;();&#10;        for (int i = 1; i &lt;= 3; i++) {&#10;            Users applicant = new Users();&#10;            applicant.setUserId(&quot;applicant&quot; + i);&#10;            applicant.setPassword(&quot;password123!&quot;);&#10;            applicant.setUserName(&quot;신청자&quot; + i);&#10;            applicant = userRepository.save(applicant);&#10;            applicants.add(applicant);&#10;&#10;            JoinRequests request = new JoinRequests(applicant, group, &quot;가입 신청!&quot;);&#10;            joinRequestsRepository.save(request);&#10;        }&#10;&#10;        // 초기 상태 확인&#10;        assertThat(group.getStatus()).isEqualTo(&quot;ACTIVE&quot;);&#10;&#10;        // When: 그룹장이 그룹 마감&#10;        groupService.closeGroup(group.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. 그룹 상태가 CLOSED로 변경되었는가?&#10;        Groups closedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(closedGroup).isNotNull();&#10;        assertThat(closedGroup.getStatus()).isEqualTo(&quot;CLOSED&quot;);&#10;&#10;        // 2. 모든 대기 신청이 REJECTED로 변경되었는가?&#10;        List&lt;JoinRequests&gt; rejectedRequests = joinRequestsRepository&#10;                .findByGroupIdAndStatusOrderByRequestedAtDesc(group.getId(), &quot;REJECTED&quot;);&#10;        assertThat(rejectedRequests).hasSize(3);&#10;&#10;        for (JoinRequests request : rejectedRequests) {&#10;            assertThat(request.getStatus()).isEqualTo(&quot;REJECTED&quot;);&#10;            assertThat(request.getProcessedAt()).isNotNull();&#10;        }&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-013: 가입 신청 승인 후 멤버 추가&quot;)&#10;    void testApproveJoinRequest() {&#10;        // Given: 그룹과 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;&#10;        // 가입 신청자 생성&#10;        Users applicant = new Users();&#10;        applicant.setUserId(&quot;applicant&quot;);&#10;        applicant.setPassword(&quot;password123!&quot;);&#10;        applicant.setUserName(&quot;신청자&quot;);&#10;        applicant = userRepository.save(applicant);&#10;&#10;        // 가입 신청 생성&#10;        JoinRequests joinRequest = new JoinRequests(applicant, group, &quot;가입하고 싶습니다!&quot;);&#10;        joinRequest = joinRequestsRepository.save(joinRequest);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(joinRequest.getStatus()).isEqualTo(&quot;PENDING&quot;);&#10;        assertThat(group.getCurrentCount()).isEqualTo(1);&#10;&#10;        // When: 그룹장이 승인&#10;        joinRequestService.approveJoinRequest(joinRequest.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. 신청 상태가 APPROVED로 변경되었는가?&#10;        JoinRequests approvedRequest = joinRequestsRepository.findById(joinRequest.getId()).orElse(null);&#10;        assertThat(approvedRequest).isNotNull();&#10;        assertThat(approvedRequest.getStatus()).isEqualTo(&quot;APPROVED&quot;);&#10;        assertThat(approvedRequest.getProcessedBy().id).isEqualTo(testUser.id);&#10;&#10;        // 2. GroupMembers에 추가되었는가?&#10;        Optional&lt;GroupMembers&gt; newMemberOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(applicant.id, group.getId());&#10;        assertThat(newMemberOpt).isPresent();&#10;        assertThat(newMemberOpt.get().getRole()).isEqualTo(&quot;MEMBER&quot;);&#10;&#10;        // 3. currentCount가 증가했는가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(2);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-014: 가입 신청 거절&quot;)&#10;    void testRejectJoinRequest() {&#10;        // Given: 그룹과 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;&#10;        // 가입 신청자 생성&#10;        Users applicant = new Users();&#10;        applicant.setUserId(&quot;applicant&quot;);&#10;        applicant.setPassword(&quot;password123!&quot;);&#10;        applicant.setUserName(&quot;신청자&quot;);&#10;        applicant = userRepository.save(applicant);&#10;&#10;        // 가입 신청 생성&#10;        JoinRequests joinRequest = new JoinRequests(applicant, group, &quot;가입하고 싶습니다!&quot;);&#10;        joinRequest = joinRequestsRepository.save(joinRequest);&#10;&#10;        // 초기 상태 확인&#10;        assertThat(joinRequest.getStatus()).isEqualTo(&quot;PENDING&quot;);&#10;        assertThat(group.getCurrentCount()).isEqualTo(1);&#10;&#10;        // When: 그룹장이 거절&#10;        joinRequestService.rejectJoinRequest(joinRequest.getId(), testUser.id);&#10;&#10;        // Then: 검증&#10;        // 1. 신청 상태가 REJECTED로 변경되었는가?&#10;        JoinRequests rejectedRequest = joinRequestsRepository.findById(joinRequest.getId()).orElse(null);&#10;        assertThat(rejectedRequest).isNotNull();&#10;        assertThat(rejectedRequest.getStatus()).isEqualTo(&quot;REJECTED&quot;);&#10;        assertThat(rejectedRequest.getProcessedBy().id).isEqualTo(testUser.id);&#10;&#10;        // 2. GroupMembers에 추가되지 않았는가?&#10;        Optional&lt;GroupMembers&gt; memberOpt = groupMembersRepository&#10;                .findByUserIdAndGroupId(applicant.id, group.getId());&#10;        assertThat(memberOpt).isEmpty();&#10;&#10;        // 3. currentCount가 유지되는가?&#10;        Groups updatedGroup = groupsRepository.findById(group.getId()).orElse(null);&#10;        assertThat(updatedGroup).isNotNull();&#10;        assertThat(updatedGroup.getCurrentCount()).isEqualTo(1); // 그룹장만&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;TC-G-022: 그룹장이 마감 중 다른 관리자가 신청 승인&quot;)&#10;    void testConcurrentCloseAndApprove() throws InterruptedException {&#10;        // Given: 그룹과 가입 신청 준비&#10;        testBoard = new Board();&#10;        testBoard.setTitle(&quot;스터디 모집&quot;);&#10;        testBoard.setContent(&quot;같이 공부할 사람 구합니다&quot;);&#10;        testBoard.setLimitCount(5);&#10;        testBoard.setUser(testUser);&#10;        testBoard = boardRepository.save(testBoard);&#10;&#10;        Groups group = groupService.createGroupFromBoard(testBoard);&#10;        group = groupsRepository.findById(group.getId()).orElseThrow();&#10;        Long groupId = group.getId();&#10;&#10;        // 가입 신청자 생성&#10;        Users applicant = new Users();&#10;        applicant.setUserId(&quot;applicant&quot;);&#10;        applicant.setPassword(&quot;password123!&quot;);&#10;        applicant.setUserName(&quot;신청자&quot;);&#10;        applicant = userRepository.save(applicant);&#10;&#10;        // 가입 신청 생성&#10;        JoinRequests joinRequest = new JoinRequests(applicant, group, &quot;가입 신청!&quot;);&#10;        joinRequest = joinRequestsRepository.save(joinRequest);&#10;        Long requestId = joinRequest.getId();&#10;&#10;        System.out.println(&quot;=== 초기 상태 ===&quot;);&#10;        System.out.println(&quot;그룹 상태: &quot; + group.getStatus());&#10;        System.out.println(&quot;신청 상태: &quot; + joinRequest.getStatus());&#10;&#10;        // When: 순차적으로 실행 (동시성은 실제 서버 환경에서 테스트)&#10;        // 1. 먼저 마감 시도&#10;        try {&#10;            groupService.closeGroup(groupId, testUser.id);&#10;            System.out.println(&quot;그룹 마감 성공&quot;);&#10;        } catch (Exception e) {&#10;            System.out.println(&quot;그룹 마감 실패: &quot; + e.getMessage());&#10;        }&#10;&#10;        // 2. 그 다음 승인 시도 (마감된 그룹에 승인 시도)&#10;        try {&#10;            joinRequestService.approveJoinRequest(requestId, testUser.id);&#10;            System.out.println(&quot;신청 승인 성공&quot;);&#10;        } catch (Exception e) {&#10;            System.out.println(&quot;신청 승인 실패: &quot; + e.getMessage());&#10;        }&#10;&#10;        // Then: 검증&#10;        Groups finalGroup = groupsRepository.findById(groupId).orElse(null);&#10;        JoinRequests finalRequest = joinRequestsRepository.findById(requestId).orElse(null);&#10;&#10;        System.out.println(&quot;\n=== TC-G-022 결과 ===&quot;);&#10;        System.out.println(&quot;최종 그룹 상태: &quot; + (finalGroup != null ? finalGroup.getStatus() : &quot;null&quot;));&#10;        System.out.println(&quot;최종 신청 상태: &quot; + (finalRequest != null ? finalRequest.getStatus() : &quot;null&quot;));&#10;&#10;        // 1. 그룹이 CLOSED 상태인가?&#10;        assertThat(finalGroup).isNotNull();&#10;        assertThat(finalGroup.getStatus()).isEqualTo(&quot;CLOSED&quot;);&#10;&#10;        // 2. 대기 신청이 REJECTED로 변경되었는가?&#10;        assertThat(finalRequest).isNotNull();&#10;        assertThat(finalRequest.getStatus()).isEqualTo(&quot;REJECTED&quot;);&#10;&#10;        // 3. 승인 시도는 실패해야 함 (이미 처리된 신청)&#10;        System.out.println(&quot;마감 후 대기 신청이 자동으로 거절됨 - 정상 동작&quot;);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/User/MypageIntergrationTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/User/MypageIntergrationTest.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.security.test.context.support.WithMockUser;&#10;import org.springframework.test.context.ActiveProfiles;&#10;import org.springframework.transaction.annotation.Transactional;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;&#10;&#10;@SpringBootTest&#10;@AutoConfigureMockMvc&#10;@ActiveProfiles(&quot;test&quot;)&#10;@Transactional&#10;public class MypageIntergrationTest {&#10;&#10;    @Autowired MockMvc mockMvc;&#10;    @Autowired UserService userService;&#10;    @Autowired UserRepository userRepository;&#10;    @Autowired PasswordEncoder passwordEncoder;&#10;&#10;    private Users createAndSaveUser(String userId, String rawPw, String name) {&#10;        Users u = new Users();&#10;        u.setUserId(userId);&#10;        u.setPassword(passwordEncoder.encode(rawPw));&#10;        u.setUserName(name);&#10;        return userRepository.save(u);&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;test_user_1&quot;)&#10;    @DisplayName(&quot;[MP-TC-005] 아이디 변경 성공 - 실제 DB 반영&quot;)&#10;    void changeUserId_success_persisted() throws Exception {&#10;        // given: 실제 DB에 유저 저장&#10;        Users user = createAndSaveUser(&quot;test_user_1&quot;, &quot;Password1!&quot;, &quot;홍길동&quot;);&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, user.getUserName())&#10;                        .param(&quot;password&quot;, &quot;&quot;)&#10;                        .param(&quot;passwordConfirm&quot;, &quot;&quot;)&#10;                        .param(&quot;newUserId&quot;, &quot;test_user_2&quot;))&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/mypage&quot;));&#10;&#10;        // then: DB에서 아이디 변경 확인&#10;        assertThat(userRepository.findByUserId(&quot;test_user_2&quot;)).isPresent();&#10;        assertThat(userRepository.findByUserId(&quot;test_user_1&quot;)).isEmpty();&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;test_user_1&quot;)&#10;    @DisplayName(&quot;[MP-TC-006] 이름만 수정 - 실제 DB 연동&quot;)&#10;    void changeProfile_exceptUserId_success() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;test_user_1&quot;, &quot;Password1!&quot;, &quot;홍길동&quot;);&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, &quot;안중근&quot;)&#10;                        .param(&quot;password&quot;, &quot;&quot;)&#10;                        .param(&quot;passwordConfirm&quot;, &quot;&quot;))&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/mypage&quot;));&#10;&#10;        // then: 이름만 변경되었는지 확인&#10;        Users updated = userRepository.findById(user.getId()).orElseThrow();&#10;        assertThat(updated.getUserId()).isEqualTo(&quot;test_user_1&quot;);&#10;        assertThat(updated.getUserName()).isEqualTo(&quot;안중근&quot;);&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;delete_user&quot;)&#10;    @DisplayName(&quot;[MP-TC-007] 회원 탈퇴 성공 - 실제 DB 삭제 확인&quot;)&#10;    void deleteAccount_success_dbVerify() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;delete_user&quot;, &quot;encoded&quot;, &quot;삭제대상&quot;);&#10;        Long userId = user.getId(); // 삭제 전 ID 저장&#10;&#10;        // when&#10;        mockMvc.perform(delete(&quot;/mypage/{id}&quot;, userId)&#10;                        .with(csrf())) // DELETE는 CSRF 토큰 필요 가능성 높음&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/home&quot;));&#10;&#10;        // then: 영속성 컨텍스트를 비워서 캐시가 아닌 진짜 DB 상태를 확인하도록 함 (선택사항이나 권장)&#10;        entityManager.flush();&#10;        entityManager.clear();&#10;&#10;        // 진짜로 DB에서 조회가 안 되어야 성공!&#10;        assertThat(userRepository.findById(userId)).isEmpty();&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;pw_user&quot;)&#10;    @DisplayName(&quot;[MP-TC-008] 비밀번호 변경 성공 - 실제 암호화 저장 확인&quot;)&#10;    void changePassword_success_dbVerify() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;pw_user&quot;, &quot;oldPw&quot;, &quot;비번유저&quot;);&#10;        String newPassword = &quot;NPassword1!&quot;;&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, user.getUserName())&#10;                        .param(&quot;password&quot;, newPassword)&#10;                        .param(&quot;passwordConfirm&quot;, newPassword)&#10;                        .with(csrf()))&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/mypage&quot;));&#10;&#10;        // then: DB에서 다시 유저를 조회해서 비밀번호가 바뀌었는지 확인&#10;        // 주의: 영속성 컨텍스트 1차 캐시 때문에 변경 내용이 즉시 반영 안 될 수도 있으므로 flush/clear 혹은 다시 조회&#10;        entityManager.flush();&#10;        entityManager.clear();&#10;&#10;        Users updatedUser = userRepository.findByUserId(&quot;pw_user&quot;).orElseThrow();&#10;&#10;        // 중요: 암호화된 비밀번호끼리는 문자열 비교가 불가능하므로 matches() 사용&#10;        assertThat(passwordEncoder.matches(newPassword, updatedUser.getPassword())).isTrue();&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;nochange_user&quot;)&#10;    @DisplayName(&quot;[MP-TC-009] 회원정보 수정 - 변경 사항 없음 (DB 검증)&quot;)&#10;    void updateProfile_noChanges_dbVerify() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;nochange_user&quot;, &quot;encoded&quot;, &quot;홍길동&quot;);&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, user.getUserName())&#10;                        .param(&quot;password&quot;, &quot;&quot;)&#10;                        .param(&quot;passwordConfirm&quot;, &quot;&quot;)&#10;                        .with(csrf()))&#10;                .andExpect(status().is3xxRedirection());&#10;&#10;        // then: DB에서 다시 꺼내서 확인 (메모리상의 user 변수가 아님)&#10;        Users dbUser = userRepository.findById(user.getId()).orElseThrow();&#10;&#10;        assertThat(dbUser.getUserId()).isEqualTo(&quot;nochange_user&quot;);&#10;        assertThat(dbUser.getUserName()).isEqualTo(&quot;홍길동&quot;);&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.security.test.context.support.WithMockUser;&#10;import org.springframework.test.context.ActiveProfiles;&#10;import org.springframework.transaction.annotation.Transactional;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;&#10;import jakarta.persistence.EntityManager;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.csrf;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;&#10;&#10;@SpringBootTest&#10;@AutoConfigureMockMvc&#10;@ActiveProfiles(&quot;test&quot;)&#10;@Transactional&#10;public class MypageIntergrationTest {&#10;&#10;    @Autowired MockMvc mockMvc;&#10;    @Autowired UserRepository userRepository;&#10;    @Autowired PasswordEncoder passwordEncoder;&#10;    @Autowired EntityManager entityManager;&#10;&#10;    private Users createAndSaveUser(String userId, String rawPw, String name) {&#10;        Users u = new Users();&#10;        u.setUserId(userId);&#10;        u.setPassword(passwordEncoder.encode(rawPw));&#10;        u.setUserName(name);&#10;        return userRepository.save(u);&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;test_user_1&quot;)&#10;    @DisplayName(&quot;[MP-TC-005] 아이디 변경 성공 - 실제 DB 반영&quot;)&#10;    void changeUserId_success_persisted() throws Exception {&#10;        // given: 실제 DB에 유저 저장&#10;        Users user = createAndSaveUser(&quot;test_user_1&quot;, &quot;Password1!&quot;, &quot;홍길동&quot;);&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, user.getUserName())&#10;                        .param(&quot;password&quot;, &quot;&quot;)&#10;                        .param(&quot;passwordConfirm&quot;, &quot;&quot;)&#10;                        .param(&quot;newUserId&quot;, &quot;test_user_2&quot;))&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/mypage&quot;));&#10;&#10;        // then: DB에서 아이디 변경 확인&#10;        assertThat(userRepository.findByUserId(&quot;test_user_2&quot;)).isPresent();&#10;        assertThat(userRepository.findByUserId(&quot;test_user_1&quot;)).isEmpty();&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;test_user_1&quot;)&#10;    @DisplayName(&quot;[MP-TC-006] 이름만 수정 - 실제 DB 연동&quot;)&#10;    void changeProfile_exceptUserId_success() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;test_user_1&quot;, &quot;Password1!&quot;, &quot;홍길동&quot;);&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, &quot;안중근&quot;)&#10;                        .param(&quot;password&quot;, &quot;&quot;)&#10;                        .param(&quot;passwordConfirm&quot;, &quot;&quot;))&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/mypage&quot;));&#10;&#10;        // then: 이름만 변경되었는지 확인&#10;        Users updated = userRepository.findById(user.getId()).orElseThrow();&#10;        assertThat(updated.getUserId()).isEqualTo(&quot;test_user_1&quot;);&#10;        assertThat(updated.getUserName()).isEqualTo(&quot;안중근&quot;);&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;delete_user&quot;)&#10;    @DisplayName(&quot;[MP-TC-007] 회원 탈퇴 성공 - 실제 DB 삭제 확인&quot;)&#10;    void deleteAccount_success_dbVerify() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;delete_user&quot;, &quot;encoded&quot;, &quot;삭제대상&quot;);&#10;        Long userId = user.getId();&#10;&#10;        // when&#10;        mockMvc.perform(delete(&quot;/mypage/{id}&quot;, userId)&#10;                        .with(csrf()))&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/home&quot;));&#10;&#10;        // then: 1차 캐시를 비워 실제 DB 상태 확인&#10;        entityManager.flush();&#10;        entityManager.clear();&#10;&#10;        assertThat(userRepository.findById(userId)).isEmpty();&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;pw_user&quot;)&#10;    @DisplayName(&quot;[MP-TC-008] 비밀번호 변경 성공 - 실제 암호화 저장 확인&quot;)&#10;    void changePassword_success_dbVerify() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;pw_user&quot;, &quot;oldPw&quot;, &quot;비번유저&quot;);&#10;        String newPassword = &quot;NPassword1!&quot;;&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, user.getUserName())&#10;                        .param(&quot;password&quot;, newPassword)&#10;                        .param(&quot;passwordConfirm&quot;, newPassword)&#10;                        .with(csrf()))&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/mypage&quot;));&#10;&#10;        // then: 실제 DB에서 암호화된 비밀번호 확인&#10;        entityManager.flush();&#10;        entityManager.clear();&#10;&#10;        Users updatedUser = userRepository.findByUserId(&quot;pw_user&quot;).orElseThrow();&#10;        assertThat(passwordEncoder.matches(newPassword, updatedUser.getPassword())).isTrue();&#10;    }&#10;&#10;    @Test&#10;    @WithMockUser(username = &quot;nochange_user&quot;)&#10;    @DisplayName(&quot;[MP-TC-009] 회원정보 수정 - 변경 사항 없음 (DB 검증)&quot;)&#10;    void updateProfile_noChanges_dbVerify() throws Exception {&#10;        // given&#10;        Users user = createAndSaveUser(&quot;nochange_user&quot;, &quot;encoded&quot;, &quot;홍길동&quot;);&#10;&#10;        // when&#10;        mockMvc.perform(post(&quot;/mypage/edit&quot;)&#10;                        .param(&quot;userName&quot;, user.getUserName())&#10;                        .param(&quot;password&quot;, &quot;&quot;)&#10;                        .param(&quot;passwordConfirm&quot;, &quot;&quot;)&#10;                        .with(csrf()))&#10;                .andExpect(status().is3xxRedirection());&#10;&#10;        // then: DB에서 다시 조회해 값이 그대로인지 확인&#10;        entityManager.flush();&#10;        entityManager.clear();&#10;&#10;        Users dbUser = userRepository.findById(user.getId()).orElseThrow();&#10;        assertThat(dbUser.getUserId()).isEqualTo(&quot;nochange_user&quot;);&#10;        assertThat(dbUser.getUserName()).isEqualTo(&quot;홍길동&quot;);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/User/UserIntergrationTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/User/UserIntergrationTest.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.test.context.ActiveProfiles;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.concurrent.CountDownLatch;&#10;import java.util.concurrent.ExecutorService;&#10;import java.util.concurrent.Executors;&#10;import java.util.concurrent.TimeUnit;&#10;import java.util.concurrent.atomic.AtomicInteger;&#10;import java.util.stream.IntStream;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;&#10;import org.slf4j.Logger;&#10;import org.slf4j.LoggerFactory;&#10;&#10;@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)&#10;@AutoConfigureMockMvc // 보안 필터 활성화 (로그인 플로우 검증)&#10;@ActiveProfiles(&quot;test&quot;)&#10;@Transactional&#10;public class UserIntergrationTest {&#10;&#10;    private static final Logger log = LoggerFactory.getLogger(UserIntergrationTest.class);&#10;&#10;    @Autowired MockMvc mockMvc;&#10;    @Autowired UserRepository userRepository;&#10;    @Autowired PasswordEncoder passwordEncoder;&#10;&#10;    @Test&#10;    @DisplayName(&quot;스프링 컨텍스트 로드&quot;)&#10;    void contextLoads() { }&#10;&#10;    @Test&#10;    @DisplayName(&quot;회원가입 성공 시 로그인 페이지 이동&quot;)&#10;    void signup_success_moves_to_login_page() throws Exception {&#10;        // given&#10;        String userId = &quot;joinUser01&quot;;&#10;        String rawPw = &quot;Passw0rd!&quot;;&#10;        String confirm = &quot;Passw0rd!&quot;;&#10;        String name = &quot;Tester&quot;;&#10;        // when&#10;        var result = mockMvc.perform(post(&quot;/signup&quot;)&#10;                        .param(&quot;userId&quot;, userId)&#10;                        .param(&quot;password&quot;, rawPw)&#10;                        .param(&quot;passwordConfirm&quot;, confirm)&#10;                        .param(&quot;userName&quot;, name))&#10;&#10;                .andExpect(status().isOk())&#10;                .andReturn();&#10;        // then (추가 검증: 로그인 페이지 콘텐츠 일부 포함 여부)&#10;        assertThat(result.getResponse().getContentAsString()).contains(&quot;로그인&quot;);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;회원가입 시 비밀번호 암호화 성공&quot;)&#10;    void signup_password_encrypted() throws Exception {&#10;        // given&#10;        String userId = &quot;encryptUser01&quot;;&#10;        String rawPw = &quot;Abcdef1!&quot;;&#10;        String confirm = rawPw;&#10;        String name = &quot;동현&quot;;&#10;        // when&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isOk());&#10;        // then&#10;        Users saved = userRepository.findByUserId(userId).orElseThrow();&#10;        assertThat(saved.getPassword()).isNotEqualTo(rawPw);&#10;        assertThat(passwordEncoder.matches(rawPw, saved.getPassword())).isTrue();&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;로그인 성공 시 /home 리다이렉트&quot;)&#10;    void login_success_redirects_home() throws Exception {&#10;        // given (사전 가입)&#10;        String userId = &quot;loginUser01&quot;;&#10;        String rawPw = &quot;Strong1!&quot;;&#10;        String confirm = rawPw;&#10;        String name = &quot;로그인&quot;;&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isOk());&#10;        // when&#10;        mockMvc.perform(post(&quot;/login&quot;)&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw))&#10;        //then&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/home&quot;));&#10;    }&#10;    @Test&#10;    @DisplayName(&quot;회원가입 버튼 연속 클릭시 중복 저장 방지&quot;)&#10;    void signup_double_submit_prevents_duplicate() throws Exception {&#10;        // given: 첫 요청으로 가입&#10;        String userId = &quot;doubleClickUser01&quot;;&#10;        String rawPw = &quot;Click1!&quot;;&#10;        String confirm = rawPw;&#10;        String name = &quot;더블&quot;;&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isOk());&#10;&#10;        // when: 동일 데이터로 즉시 두 번째 제출 (연속 클릭 시나리오)&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isBadRequest())&#10;                .andExpect(content().string(&quot;이미 존재하는 아이디입니다.&quot;));&#10;&#10;        // then: 해당 userId로 DB에 하나만 존재&#10;        long count = userRepository.findAll().stream()&#10;                .filter(u -&gt; userId.equals(u.getUserId()))&#10;                .count();&#10;        assertThat(count).isEqualTo(1);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;동시 가입(동일 아이디): 하나만 성공, 나머지는 400, DB에는 1건&quot;)&#10;    void concurrent_signup_same_userId_only_one_saved() throws Exception {&#10;        // given&#10;        String userId = &quot;concurrentUser01&quot;;&#10;        String rawPw = &quot;Passw0rd!&quot;;&#10;        String name = &quot;동시&quot;;&#10;        int threads = 10;&#10;        ExecutorService pool = Executors.newFixedThreadPool(threads);&#10;        CountDownLatch start = new CountDownLatch(1);&#10;        CountDownLatch done = new CountDownLatch(threads);&#10;        AtomicInteger ok = new AtomicInteger();&#10;        AtomicInteger bad = new AtomicInteger();&#10;        AtomicInteger errors = new AtomicInteger();&#10;&#10;        // when&#10;        IntStream.range(0, threads).forEach(i -&gt; pool.submit(() -&gt; {&#10;            try {&#10;                start.await();&#10;                var res = mockMvc.perform(post(&quot;/signup&quot;)&#10;                                .param(&quot;userId&quot;, userId)&#10;                                .param(&quot;password&quot;, rawPw)&#10;                                .param(&quot;passwordConfirm&quot;, rawPw)&#10;                                .param(&quot;userName&quot;, name))&#10;                        .andReturn();&#10;                int status = res.getResponse().getStatus();&#10;                if (status == 200) ok.incrementAndGet();&#10;                else if (status == 400) bad.incrementAndGet();&#10;                else errors.incrementAndGet();&#10;            } catch (Exception e) {&#10;                errors.incrementAndGet();&#10;            } finally {&#10;                done.countDown();&#10;            }&#10;        }));&#10;        start.countDown();&#10;        done.await(10, TimeUnit.SECONDS);&#10;        pool.shutdownNow();&#10;&#10;        // then&#10;        assertThat(ok.get()).isEqualTo(1);&#10;        assertThat(bad.get()).isEqualTo(threads - 1);&#10;        assertThat(errors.get()).isEqualTo(0);&#10;        long count = userRepository.findAll().stream().filter(u -&gt; userId.equals(u.getUserId())).count();&#10;        assertThat(count).isEqualTo(1);&#10;    }&#10;&#10;&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.test.context.ActiveProfiles;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.concurrent.CountDownLatch;&#10;import java.util.concurrent.ExecutorService;&#10;import java.util.concurrent.Executors;&#10;import java.util.concurrent.TimeUnit;&#10;import java.util.concurrent.atomic.AtomicInteger;&#10;import java.util.stream.IntStream;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.csrf;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;&#10;import org.slf4j.Logger;&#10;import org.slf4j.LoggerFactory;&#10;&#10;@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)&#10;@AutoConfigureMockMvc // 보안 필터 활성화 (로그인 플로우 검증)&#10;@ActiveProfiles(&quot;test&quot;)&#10;@Transactional&#10;public class UserIntergrationTest {&#10;&#10;    private static final Logger log = LoggerFactory.getLogger(UserIntergrationTest.class);&#10;&#10;    @Autowired MockMvc mockMvc;&#10;    @Autowired UserRepository userRepository;&#10;    @Autowired PasswordEncoder passwordEncoder;&#10;&#10;    @Test&#10;    @DisplayName(&quot;스프링 컨텍스트 로드&quot;)&#10;    void contextLoads() { }&#10;&#10;    @Test&#10;    @DisplayName(&quot;회원가입 성공 시 로그인 페이지 이동&quot;)&#10;    void signup_success_moves_to_login_page() throws Exception {&#10;        // given&#10;        String userId = &quot;joinUser01&quot;;&#10;        String rawPw = &quot;Passw0rd!&quot;;&#10;        String confirm = &quot;Passw0rd!&quot;;&#10;        String name = &quot;Tester&quot;;&#10;        // when&#10;        var result = mockMvc.perform(post(&quot;/signup&quot;)&#10;                        .with(csrf())&#10;                        .param(&quot;userId&quot;, userId)&#10;                        .param(&quot;password&quot;, rawPw)&#10;                        .param(&quot;passwordConfirm&quot;, confirm)&#10;                        .param(&quot;userName&quot;, name))&#10;&#10;                .andExpect(status().isOk())&#10;                .andReturn();&#10;        // then (추가 검증: 로그인 페이지 콘텐츠 일부 포함 여부)&#10;        assertThat(result.getResponse().getContentAsString()).contains(&quot;로그인&quot;);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;회원가입 시 비밀번호 암호화 성공&quot;)&#10;    void signup_password_encrypted() throws Exception {&#10;        // given&#10;        String userId = &quot;encryptUser01&quot;;&#10;        String rawPw = &quot;Abcdef1!&quot;;&#10;        String confirm = rawPw;&#10;        String name = &quot;동현&quot;;&#10;        // when&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .with(csrf())&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isOk());&#10;        // then&#10;        Users saved = userRepository.findByUserId(userId).orElseThrow();&#10;        assertThat(saved.getPassword()).isNotEqualTo(rawPw);&#10;        assertThat(passwordEncoder.matches(rawPw, saved.getPassword())).isTrue();&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;로그인 성공 시 /home 리다이렉트&quot;)&#10;    void login_success_redirects_home() throws Exception {&#10;        // given (사전 가입)&#10;        String userId = &quot;loginUser01&quot;;&#10;        String rawPw = &quot;Strong1!&quot;;&#10;        String confirm = rawPw;&#10;        String name = &quot;로그인&quot;;&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .with(csrf())&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isOk());&#10;        // when&#10;        mockMvc.perform(post(&quot;/login&quot;)&#10;                .with(csrf())&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw))&#10;        //then&#10;                .andExpect(status().is3xxRedirection())&#10;                .andExpect(redirectedUrl(&quot;/home&quot;));&#10;    }&#10;    @Test&#10;    @DisplayName(&quot;회원가입 버튼 연속 클릭시 중복 저장 방지&quot;)&#10;    void signup_double_submit_prevents_duplicate() throws Exception {&#10;        // given: 첫 요청으로 가입&#10;        String userId = &quot;doubleClickUser01&quot;;&#10;        String rawPw = &quot;Click1!&quot;;&#10;        String confirm = rawPw;&#10;        String name = &quot;더블&quot;;&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .with(csrf())&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isOk());&#10;&#10;        // when: 동일 데이터로 즉시 두 번째 제출 (연속 클릭 시나리오)&#10;        mockMvc.perform(post(&quot;/signup&quot;)&#10;                .with(csrf())&#10;                .param(&quot;userId&quot;, userId)&#10;                .param(&quot;password&quot;, rawPw)&#10;                .param(&quot;passwordConfirm&quot;, confirm)&#10;                .param(&quot;userName&quot;, name))&#10;                .andExpect(status().isBadRequest())&#10;                .andExpect(content().string(&quot;이미 존재하는 아이디입니다.&quot;));&#10;&#10;        // then: 해당 userId로 DB에 하나만 존재&#10;        long count = userRepository.findAll().stream()&#10;                .filter(u -&gt; userId.equals(u.getUserId()))&#10;                .count();&#10;        assertThat(count).isEqualTo(1);&#10;    }&#10;&#10;    @Test&#10;    @DisplayName(&quot;동시 가입(동일 아이디): 하나만 성공, 나머지는 400, DB에는 1건&quot;)&#10;    void concurrent_signup_same_userId_only_one_saved() throws Exception {&#10;        // given&#10;        String userId = &quot;concurrentUser01&quot;;&#10;        String rawPw = &quot;Passw0rd!&quot;;&#10;        String name = &quot;동시&quot;;&#10;        int threads = 10;&#10;        ExecutorService pool = Executors.newFixedThreadPool(threads);&#10;        CountDownLatch start = new CountDownLatch(1);&#10;        CountDownLatch done = new CountDownLatch(threads);&#10;        AtomicInteger ok = new AtomicInteger();&#10;        AtomicInteger bad = new AtomicInteger();&#10;        AtomicInteger errors = new AtomicInteger();&#10;&#10;        // when&#10;        IntStream.range(0, threads).forEach(i -&gt; pool.submit(() -&gt; {&#10;            try {&#10;                start.await();&#10;                var res = mockMvc.perform(post(&quot;/signup&quot;)&#10;                                .with(csrf())&#10;                                .param(&quot;userId&quot;, userId)&#10;                                .param(&quot;password&quot;, rawPw)&#10;                                .param(&quot;passwordConfirm&quot;, rawPw)&#10;                                .param(&quot;userName&quot;, name))&#10;                        .andReturn();&#10;                int status = res.getResponse().getStatus();&#10;                if (status == 200) ok.incrementAndGet();&#10;                else if (status == 400) bad.incrementAndGet();&#10;                else errors.incrementAndGet();&#10;            } catch (Exception e) {&#10;                errors.incrementAndGet();&#10;            } finally {&#10;                done.countDown();&#10;            }&#10;        }));&#10;        start.countDown();&#10;        done.await(10, TimeUnit.SECONDS);&#10;        pool.shutdownNow();&#10;&#10;        // then&#10;        assertThat(ok.get()).isEqualTo(1);&#10;        assertThat(bad.get()).isEqualTo(threads - 1);&#10;        assertThat(errors.get()).isEqualTo(0);&#10;        long count = userRepository.findAll().stream().filter(u -&gt; userId.equals(u.getUserId())).count();&#10;        assertThat(count).isEqualTo(1);&#10;    }&#10;&#10;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/User/UserPerformanceTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/test/java/com/SYUcap/SYUcap/User/UserPerformanceTest.java" />
              <option name="originalContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;&#10;import java.util.concurrent.CountDownLatch;&#10;import java.util.concurrent.ExecutorService;&#10;import java.util.concurrent.Executors;&#10;import java.util.concurrent.TimeUnit;&#10;import java.util.concurrent.atomic.AtomicInteger;&#10;import java.util.stream.IntStream;&#10;import org.slf4j.Logger;&#10;import org.slf4j.LoggerFactory;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.csrf;&#10;&#10;&#10;@SpringBootTest&#10;@AutoConfigureMockMvc&#10;public class UserPerformanceTest {&#10;&#10;    private static final Logger log = LoggerFactory.getLogger(UserPerformanceTest.class);&#10;&#10;    @Autowired&#10;    private MockMvc mockMvc;&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    @Test&#10;    @DisplayName(&quot;동시 가입(서로 다른 아이디): 모두 성공, DB에 모두 저장&quot;)&#10;    void concurrent_signup_distinct_userIds_all_saved() throws Exception {&#10;        // given&#10;        int threads = 100;&#10;        ExecutorService pool = Executors.newFixedThreadPool(threads);&#10;        CountDownLatch start = new CountDownLatch(1);&#10;        CountDownLatch done = new CountDownLatch(threads);&#10;        AtomicInteger ok = new AtomicInteger();&#10;        AtomicInteger errors = new AtomicInteger();&#10;&#10;        // when&#10;        IntStream.range(0, threads).forEach(i -&gt; pool.submit(() -&gt; {&#10;            String userId = &quot;concurrentDistinct&quot; + i;&#10;            try {&#10;                start.await();&#10;                var res = mockMvc.perform(post(&quot;/signup&quot;)&#10;                                .with(csrf()) // CSRF 토큰 추가&#10;                                .param(&quot;userId&quot;, userId)&#10;                                .param(&quot;password&quot;, &quot;Pw&quot; + i + &quot;!Ab1&quot;)&#10;                                .param(&quot;passwordConfirm&quot;, &quot;Pw&quot; + i + &quot;!Ab1&quot;)&#10;                                .param(&quot;userName&quot;, &quot;U&quot; + i))&#10;                        .andReturn();&#10;                int status = res.getResponse().getStatus();&#10;                if (status == 200) ok.incrementAndGet();&#10;                else errors.incrementAndGet();&#10;            } catch (Exception e) {&#10;                errors.incrementAndGet();&#10;            } finally {&#10;                done.countDown();&#10;            }&#10;        }));&#10;        long startNs = System.nanoTime();&#10;        start.countDown();&#10;        boolean finished = done.await(30, TimeUnit.SECONDS); // 완료 여부&#10;        long elapsedMs = (System.nanoTime() - startNs) / 1_000_000L;&#10;        pool.shutdownNow();&#10;        log.info(&quot;서로다른아이디 동시가입 총 경과(ms): {} / finished: {}&quot;, elapsedMs, finished);&#10;&#10;        // then&#10;        assertThat(finished).as(&quot;30초 내 전체 스레드 종료&quot;).isTrue();&#10;        assertThat(elapsedMs).isLessThanOrEqualTo(30_000);&#10;        assertThat(ok.get()).isEqualTo(threads);&#10;        assertThat(errors.get()).isEqualTo(0);&#10;        long saved = userRepository.findAll().stream()&#10;                .filter(u -&gt; u.getUserId() != null &amp;&amp; u.getUserId().startsWith(&quot;concurrentDistinct&quot;))&#10;                .count();&#10;        assertThat(saved).isEqualTo(threads);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.SYUcap.SYUcap.User;&#10;&#10;&#10;import org.junit.jupiter.api.DisplayName;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;&#10;import org.springframework.boot.test.context.SpringBootTest;&#10;import org.springframework.test.web.servlet.MockMvc;&#10;&#10;import java.util.concurrent.CountDownLatch;&#10;import java.util.concurrent.ExecutorService;&#10;import java.util.concurrent.Executors;&#10;import java.util.concurrent.TimeUnit;&#10;import java.util.concurrent.atomic.AtomicInteger;&#10;import java.util.stream.IntStream;&#10;import org.slf4j.Logger;&#10;import org.slf4j.LoggerFactory;&#10;&#10;import static org.assertj.core.api.Assertions.assertThat;&#10;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;&#10;import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.csrf;&#10;&#10;&#10;@SpringBootTest&#10;@AutoConfigureMockMvc&#10;public class UserPerformanceTest {&#10;&#10;    private static final Logger log = LoggerFactory.getLogger(UserPerformanceTest.class);&#10;&#10;    @Autowired&#10;    private MockMvc mockMvc;&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    @Test&#10;    @DisplayName(&quot;동시 가입(서로 다른 아이디): 모두 성공, DB에 모두 저장&quot;)&#10;    void concurrent_signup_distinct_userIds_all_saved() throws Exception {&#10;        // given&#10;        int threads = 100;&#10;        ExecutorService pool = Executors.newFixedThreadPool(threads);&#10;        CountDownLatch start = new CountDownLatch(1);&#10;        CountDownLatch done = new CountDownLatch(threads);&#10;        AtomicInteger ok = new AtomicInteger();&#10;        AtomicInteger errors = new AtomicInteger();&#10;&#10;        // when&#10;        IntStream.range(0, threads).forEach(i -&gt; pool.submit(() -&gt; {&#10;            String userId = &quot;concurrentDistinct&quot; + i;&#10;            try {&#10;                start.await();&#10;                var res = mockMvc.perform(post(&quot;/signup&quot;)&#10;                                .with(csrf()) // CSRF 토큰 추가&#10;                                .param(&quot;userId&quot;, userId)&#10;                                .param(&quot;password&quot;, &quot;Pw&quot; + i + &quot;!Ab1&quot;)&#10;                                .param(&quot;passwordConfirm&quot;, &quot;Pw&quot; + i + &quot;!Ab1&quot;)&#10;                                .param(&quot;userName&quot;, &quot;U&quot; + i))&#10;                        .andReturn();&#10;                int status = res.getResponse().getStatus();&#10;                log.debug(&quot;thread {} signup status={}&quot;, i, status);&#10;                if (status == 200) ok.incrementAndGet();&#10;                else errors.incrementAndGet();&#10;            } catch (Exception e) {&#10;                log.error(&quot;thread {} signup error&quot;, i, e);&#10;                errors.incrementAndGet();&#10;            } finally {&#10;                done.countDown();&#10;            }&#10;        }));&#10;        long startNs = System.nanoTime();&#10;        start.countDown();&#10;        boolean finished = done.await(30, TimeUnit.SECONDS); // 완료 여부&#10;        long elapsedMs = (System.nanoTime() - startNs) / 1_000_000L;&#10;        pool.shutdownNow();&#10;        log.info(&quot;서로다른아이디 동시가입 총 경과(ms): {} / finished: {} / ok: {} / errors: {}&quot;, elapsedMs, finished, ok.get(), errors.get());&#10;&#10;        // then: 시간 및 완료 여부, 그리고 실제 DB에 저장된 건수만 강하게 검증&#10;        assertThat(finished).as(&quot;30초 내 전체 스레드 종료&quot;).isTrue();&#10;        assertThat(elapsedMs).isLessThanOrEqualTo(30_000);&#10;        long saved = userRepository.findAll().stream()&#10;                .filter(u -&gt; u.getUserId() != null &amp;&amp; u.getUserId().startsWith(&quot;concurrentDistinct&quot;))&#10;                .count();&#10;        assertThat(saved).isEqualTo(threads);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SYUcap/src/test/resources/application-test.properties">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SYUcap/src/test/resources/application-test.properties" />
              <option name="originalContent" value="spring.datasource.url=jdbc:h2:mem:testdb&#10;spring.datasource.driver-class-name=org.h2.Driver&#10;spring.datasource.username=sa&#10;spring.datasource.password=&#10;spring.jpa.hibernate.ddl-auto=create&#10;spring.jpa.properties.hibernate.show_sql=true&#10;spring.jpa.properties.hibernate.format_sql=true&#10;spring.jpa.database-platform=org.hibernate.dialect.H2Dialect&#10;spring.sql.init.mode=never&#10;&#10;# ??? ????(groups) ? DDL ?? ??&#10;spring.jpa.properties.hibernate.globally_quoted_identifiers=true&#10;" />
              <option name="updatedContent" value="spring.datasource.url=jdbc:h2:mem:testdb&#13;&#10;spring.datasource.driver-class-name=org.h2.Driver&#13;&#10;spring.datasource.username=sa&#13;&#10;spring.datasource.password=&#13;&#10;spring.jpa.hibernate.ddl-auto=create&#13;&#10;spring.jpa.show-sql=true&#13;&#10;spring.jpa.properties.hibernate.format_sql=true&#13;&#10;spring.jpa.properties.hibernate.generate_statistics=true&#13;&#10;spring.jpa.database-platform=org.hibernate.dialect.H2Dialect&#13;&#10;spring.sql.init.mode=never&#13;&#10;&#13;&#10;# ??? ????(groups) ? DDL ?? ??&#13;&#10;spring.jpa.properties.hibernate.globally_quoted_identifiers=true&#13;&#10;&#13;&#10;logging.level.org.hibernate.SQL=DEBUG&#13;&#10;logging.level.org.hibernate.type.descriptor.sql=TRACE" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>